USE [QGLGame]
GO
/****** 对象:  Table [dbo].[ElementSkill]    脚本日期: 12/02/2011 11:56:18 ******/
DROP TABLE [dbo].[ElementSkill]
GO
/****** 对象:  Table [dbo].[WeaponsPoint]    脚本日期: 12/02/2011 11:56:19 ******/
DROP TABLE [dbo].[WeaponsPoint]
GO
/****** 对象:  StoredProcedure [dbo].[sp_Addmoney]    脚本日期: 12/02/2011 11:56:34 ******/
DROP PROCEDURE [dbo].[sp_Addmoney]
GO
/****** 对象:  StoredProcedure [dbo].[sp_GetTempBankMoneyYBT]    脚本日期: 12/02/2011 11:56:33 ******/
DROP PROCEDURE [dbo].[sp_GetTempBankMoneyYBT]
GO
/****** 对象:  View [dbo].[MsgCharView]    脚本日期: 12/02/2011 11:56:22 ******/
DROP VIEW [dbo].[MsgCharView]
GO
/****** 对象:  View [dbo].[CharacterView]    脚本日期: 12/02/2011 11:56:31 ******/
DROP VIEW [dbo].[CharacterView]
GO
/****** 对象:  StoredProcedure [dbo].[sp_RemoveRelation]    脚本日期: 12/02/2011 11:56:34 ******/
DROP PROCEDURE [dbo].[sp_RemoveRelation]
GO
/****** 对象:  StoredProcedure [dbo].[sp_InactiveAccount]    脚本日期: 12/02/2011 11:56:31 ******/
DROP PROCEDURE [dbo].[sp_InactiveAccount]
GO
/****** 对象:  StoredProcedure [dbo].[sp_ReactiveAccount]    脚本日期: 12/02/2011 11:56:31 ******/
DROP PROCEDURE [dbo].[sp_ReactiveAccount]
GO
/****** 对象:  StoredProcedure [dbo].[sp_RestoreAccount]    脚本日期: 12/02/2011 11:56:31 ******/
DROP PROCEDURE [dbo].[sp_RestoreAccount]
GO
DROP PROCEDURE [dbo].[sp_GetColNames]
GO
/****** 对象:  Table [dbo].[GuildMember]    脚本日期: 12/02/2011 11:56:33 ******/
DROP TABLE [dbo].[GuildMember]
GO
/****** 对象:  StoredProcedure [dbo].[sp_InsertSellYuanBao]    脚本日期: 12/02/2011 11:56:33 ******/
DROP PROCEDURE [dbo].[sp_InsertSellYuanBao]
GO
/****** 对象:  StoredProcedure [dbo].[sp_BuyYuanBaoTicket]    脚本日期: 12/02/2011 11:56:34 ******/
DROP PROCEDURE [dbo].[sp_BuyYuanBaoTicket]
GO
/****** 对象:  Table [dbo].[HawkerHistory]    脚本日期: 12/02/2011 11:56:33 ******/
DROP TABLE [dbo].[HawkerHistory]
GO
/****** 对象:  StoredProcedure [dbo].[sp_GetGenerationAsElder]    脚本日期: 12/02/2011 11:56:34 ******/
DROP PROCEDURE [dbo].[sp_GetGenerationAsElder]
GO
/****** 对象:  StoredProcedure [dbo].[sp_GetGenerationAsYounger]    脚本日期: 12/02/2011 11:56:34 ******/
DROP PROCEDURE [dbo].[sp_GetGenerationAsYounger]
GO
/****** 对象:  StoredProcedure [dbo].[sp_GetSpecialGenarationAsElder]    脚本日期: 12/02/2011 11:56:34 ******/
DROP PROCEDURE [dbo].[sp_GetSpecialGenarationAsElder]
GO
/****** 对象:  StoredProcedure [dbo].[sp_GetSpecialGenarationAsYounger]    脚本日期: 12/02/2011 11:56:34 ******/
DROP PROCEDURE [dbo].[sp_GetSpecialGenarationAsYounger]
GO
/****** 对象:  Table [dbo].[Marriage]    脚本日期: 12/02/2011 11:55:31 ******/
DROP TABLE [dbo].[Marriage]
GO
/****** 对象:  Table [dbo].[QuestLog]    脚本日期: 12/02/2011 11:55:34 ******/
DROP TABLE [dbo].[QuestLog]
GO
/****** 对象:  Table [dbo].[SystemLetter]    脚本日期: 12/02/2011 11:55:37 ******/
DROP TABLE [dbo].[SystemLetter]
GO
/****** 对象:  Table [dbo].[查询]    脚本日期: 12/02/2011 11:55:37 ******/
DROP TABLE [dbo].[查询]
GO
/****** 对象:  Table [dbo].[QuestFlag]    脚本日期: 12/02/2011 11:55:37 ******/
DROP TABLE [dbo].[QuestFlag]
GO
/****** 对象:  Table [dbo].[PartnerCollection]    脚本日期: 12/02/2011 11:55:38 ******/
DROP TABLE [dbo].[PartnerCollection]
GO
/****** 对象:  Table [dbo].[QuestNpcFlag]    脚本日期: 12/02/2011 11:55:38 ******/
DROP TABLE [dbo].[QuestNpcFlag]
GO
/****** 对象:  Table [dbo].[Item]    脚本日期: 12/02/2011 11:55:48 ******/
DROP TABLE [dbo].[Item]
GO
/****** 对象:  Table [dbo].[Sibling]    脚本日期: 12/02/2011 11:55:49 ******/
DROP TABLE [dbo].[Sibling]
GO
/****** 对象:  Table [dbo].[Character]    脚本日期: 12/02/2011 11:55:57 ******/
DROP TABLE [dbo].[Character]
GO
/****** 对象:  Table [dbo].[ChargeShop]    脚本日期: 12/02/2011 11:55:59 ******/
DROP TABLE [dbo].[ChargeShop]
GO
/****** 对象:  Table [dbo].[BussinessGuild]    脚本日期: 12/02/2011 11:56:09 ******/
DROP TABLE [dbo].[BussinessGuild]
GO
/****** 对象:  Table [dbo].[QuestType]    脚本日期: 12/02/2011 11:56:09 ******/
DROP TABLE [dbo].[QuestType]
GO
/****** 对象:  Table [dbo].[Partner]    脚本日期: 12/02/2011 11:56:12 ******/
DROP TABLE [dbo].[Partner]
GO
/****** 对象:  Table [dbo].[BussinessItemInfo]    脚本日期: 12/02/2011 11:56:13 ******/
DROP TABLE [dbo].[BussinessItemInfo]
GO
/****** 对象:  Table [dbo].[BussinessLog]    脚本日期: 12/02/2011 11:56:13 ******/
DROP TABLE [dbo].[BussinessLog]
GO
/****** 对象:  Table [dbo].[InactiveCharacter]    脚本日期: 12/02/2011 11:56:13 ******/
DROP TABLE [dbo].[InactiveCharacter]
GO
/****** 对象:  Table [dbo].[Title]    脚本日期: 12/02/2011 11:56:13 ******/
DROP TABLE [dbo].[Title]
GO
/****** 对象:  Table [dbo].[Pet]    脚本日期: 12/02/2011 11:56:15 ******/
DROP TABLE [dbo].[Pet]
GO
/****** 对象:  Table [dbo].[Skill]    脚本日期: 12/02/2011 11:56:07 ******/
DROP TABLE [dbo].[Skill]
GO
/****** 对象:  Table [dbo].[ElementDesc]    脚本日期: 12/02/2011 11:56:18 ******/
DROP TABLE [dbo].[ElementDesc]
GO
/****** 对象:  Table [dbo].[Guild]    脚本日期: 12/02/2011 11:56:06 ******/
DROP TABLE [dbo].[Guild]
GO
/****** 对象:  Table [dbo].[SellYuanBao]    脚本日期: 12/02/2011 11:55:59 ******/
DROP TABLE [dbo].[SellYuanBao]
GO
/****** 对象:  Table [dbo].[Messenger]    脚本日期: 12/02/2011 11:56:16 ******/
DROP TABLE [dbo].[Messenger]
GO
/****** 对象:  Table [dbo].[Generation]    脚本日期: 12/02/2011 11:56:07 ******/
DROP TABLE [dbo].[Generation]
GO
/****** 对象:  Table [dbo].[Marriage]    脚本日期: 12/02/2011 11:55:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Marriage](
	[marriage_id] [bigint] IDENTITY(1,1) NOT NULL,
	[husband_id] [bigint] NOT NULL CONSTRAINT [DF__Marriage__husban__1CBC4616]  DEFAULT ((0)),
	[wife_id] [bigint] NOT NULL CONSTRAINT [DF__Marriage__wife_i__1DB06A4F]  DEFAULT ((0)),
	[marriage_time] [datetime] NOT NULL,
	[state] [tinyint] NOT NULL CONSTRAINT [DF__Marriage__state__1EA48E88]  DEFAULT ((0)),
 CONSTRAINT [PK_Marriage] PRIMARY KEY CLUSTERED 
(
	[marriage_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[QuestLog]    脚本日期: 12/02/2011 11:55:34 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[QuestLog](
	[char_id] [bigint] NOT NULL,
	[quest_id] [int] NOT NULL,
	[type_id] [int] NOT NULL,
	[name] [nchar](32) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__QuestLog__name__2180FB33]  DEFAULT (N''),
	[descript] [nvarchar](800) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__QuestLog__descri__22751F6C]  DEFAULT (N''),
	[beginNpc] [bigint] NOT NULL CONSTRAINT [DF__QuestLog__beginN__236943A5]  DEFAULT ((0)),
	[beginNpc_Map] [int] NOT NULL CONSTRAINT [DF__QuestLog__beginN__245D67DE]  DEFAULT ((0)),
	[beginNpc_x] [int] NOT NULL CONSTRAINT [DF__QuestLog__beginN__25518C17]  DEFAULT ((0)),
	[beginNpc_y] [int] NOT NULL CONSTRAINT [DF__QuestLog__beginN__2645B050]  DEFAULT ((0)),
	[finishNpc] [bigint] NOT NULL CONSTRAINT [DF__QuestLog__finish__2739D489]  DEFAULT ((0)),
	[finishNpc_Map] [int] NOT NULL CONSTRAINT [DF__QuestLog__finish__282DF8C2]  DEFAULT ((0)),
	[finishNpc_x] [int] NOT NULL CONSTRAINT [DF__QuestLog__finish__29221CFB]  DEFAULT ((0)),
	[finishNpc_y] [int] NOT NULL CONSTRAINT [DF__QuestLog__finish__2A164134]  DEFAULT ((0)),
	[target1_id] [bigint] NOT NULL CONSTRAINT [DF__QuestLog__target__2B0A656D]  DEFAULT ((0)),
	[target1_v1] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__2BFE89A6]  DEFAULT ((0)),
	[target1_v2] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__2CF2ADDF]  DEFAULT ((0)),
	[target1_v3] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__2DE6D218]  DEFAULT ((0)),
	[target1_vtype] [smallint] NOT NULL CONSTRAINT [DF__QuestLog__target__2EDAF651]  DEFAULT ((0)),
	[target1_num] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__2FCF1A8A]  DEFAULT ((0)),
	[target1_max] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__30C33EC3]  DEFAULT ((0)),
	[target2_id] [bigint] NOT NULL CONSTRAINT [DF__QuestLog__target__31B762FC]  DEFAULT ((0)),
	[target2_v1] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__32AB8735]  DEFAULT ((0)),
	[target2_v2] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__339FAB6E]  DEFAULT ((0)),
	[target2_v3] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__3493CFA7]  DEFAULT ((0)),
	[target2_vtype] [smallint] NOT NULL CONSTRAINT [DF__QuestLog__target__3587F3E0]  DEFAULT ((0)),
	[target2_num] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__367C1819]  DEFAULT ((0)),
	[target2_max] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__37703C52]  DEFAULT ((0)),
	[target3_id] [bigint] NOT NULL CONSTRAINT [DF__QuestLog__target__3864608B]  DEFAULT ((0)),
	[target3_v1] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__395884C4]  DEFAULT ((0)),
	[target3_v2] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__3A4CA8FD]  DEFAULT ((0)),
	[target3_v3] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__3B40CD36]  DEFAULT ((0)),
	[target3_vtype] [smallint] NOT NULL CONSTRAINT [DF__QuestLog__target__3C34F16F]  DEFAULT ((0)),
	[target3_num] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__3D2915A8]  DEFAULT ((0)),
	[target3_max] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__3E1D39E1]  DEFAULT ((0)),
	[target4_id] [bigint] NOT NULL CONSTRAINT [DF__QuestLog__target__3F115E1A]  DEFAULT ((0)),
	[target4_v1] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__40058253]  DEFAULT ((0)),
	[target4_v2] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__40F9A68C]  DEFAULT ((0)),
	[target4_v3] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__41EDCAC5]  DEFAULT ((0)),
	[target4_vtype] [smallint] NOT NULL CONSTRAINT [DF__QuestLog__target__42E1EEFE]  DEFAULT ((0)),
	[target4_num] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__43D61337]  DEFAULT ((0)),
	[target4_max] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__44CA3770]  DEFAULT ((0)),
	[target5_id] [bigint] NOT NULL CONSTRAINT [DF__QuestLog__target__45BE5BA9]  DEFAULT ((0)),
	[target5_v1] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__46B27FE2]  DEFAULT ((0)),
	[target5_v2] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__47A6A41B]  DEFAULT ((0)),
	[target5_v3] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__489AC854]  DEFAULT ((0)),
	[target5_vtype] [smallint] NOT NULL CONSTRAINT [DF__QuestLog__target__498EEC8D]  DEFAULT ((0)),
	[target5_num] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__4A8310C6]  DEFAULT ((0)),
	[target5_max] [int] NOT NULL CONSTRAINT [DF__QuestLog__target__4B7734FF]  DEFAULT ((0)),
	[timeLimit] [datetime] NULL,
	[interval] [int] NOT NULL CONSTRAINT [DF__QuestLog__interv__4C6B5938]  DEFAULT ((0)),
	[buff] [int] NOT NULL CONSTRAINT [DF__QuestLog__buff__4D5F7D71]  DEFAULT ((0)),
	[state] [smallint] NOT NULL CONSTRAINT [DF__QuestLog__state__4E53A1AA]  DEFAULT ((0)),
	[feature] [int] NOT NULL CONSTRAINT [DF__QuestLog__featur__4F47C5E3]  DEFAULT ((0)),
 CONSTRAINT [PK_QuestLog] PRIMARY KEY CLUSTERED 
(
	[char_id] ASC,
	[quest_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_QuestLog] ON [dbo].[QuestLog] 
(
	[char_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[SystemLetter]    脚本日期: 12/02/2011 11:55:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SystemLetter](
	[letter_uid] [bigint] IDENTITY(1,1) NOT NULL,
	[receiver_uid] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__recei__2610A626]  DEFAULT ((0)),
	[sender_uid] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__sende__2704CA5F]  DEFAULT ((0)),
	[sender] [nchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__SystemLet__sende__27F8EE98]  DEFAULT (N''),
	[title] [nvarchar](50) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__SystemLet__title__28ED12D1]  DEFAULT (N''),
	[message] [nvarchar](500) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__SystemLet__messa__29E1370A]  DEFAULT (N''),
	[itemID1] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__itemI__2AD55B43]  DEFAULT ((0)),
	[itemCount1] [smallint] NOT NULL CONSTRAINT [DF__SystemLet__itemC__2BC97F7C]  DEFAULT ((0)),
	[itemID2] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__itemI__2CBDA3B5]  DEFAULT ((0)),
	[itemCount2] [smallint] NOT NULL CONSTRAINT [DF__SystemLet__itemC__2DB1C7EE]  DEFAULT ((0)),
	[itemID3] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__itemI__2EA5EC27]  DEFAULT ((0)),
	[itemCount3] [smallint] NOT NULL CONSTRAINT [DF__SystemLet__itemC__2F9A1060]  DEFAULT ((0)),
	[itemID4] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__itemI__308E3499]  DEFAULT ((0)),
	[itemCount4] [smallint] NOT NULL CONSTRAINT [DF__SystemLet__itemC__318258D2]  DEFAULT ((0)),
	[itemID5] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__itemI__32767D0B]  DEFAULT ((0)),
	[itemCount5] [smallint] NOT NULL CONSTRAINT [DF__SystemLet__itemC__336AA144]  DEFAULT ((0)),
	[itemID6] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__itemI__345EC57D]  DEFAULT ((0)),
	[itemCount6] [smallint] NOT NULL CONSTRAINT [DF__SystemLet__itemC__3552E9B6]  DEFAULT ((0)),
	[partnerID1] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__partn__36470DEF]  DEFAULT ((0)),
	[partnerID2] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__partn__373B3228]  DEFAULT ((0)),
	[partnerID3] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__partn__382F5661]  DEFAULT ((0)),
	[partnerID4] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__partn__39237A9A]  DEFAULT ((0)),
	[partnerID5] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__partn__3A179ED3]  DEFAULT ((0)),
	[partnerID6] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__partn__3B0BC30C]  DEFAULT ((0)),
	[petID1] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__petID__3BFFE745]  DEFAULT ((0)),
	[petID2] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__petID__3CF40B7E]  DEFAULT ((0)),
	[petID3] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__petID__3DE82FB7]  DEFAULT ((0)),
	[petID4] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__petID__3EDC53F0]  DEFAULT ((0)),
	[petID5] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__petID__3FD07829]  DEFAULT ((0)),
	[petID6] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__petID__40C49C62]  DEFAULT ((0)),
	[money] [bigint] NOT NULL CONSTRAINT [DF__SystemLet__money__41B8C09B]  DEFAULT ((0)),
	[timeLimit] [datetime] NULL,
	[readFlag] [tinyint] NOT NULL CONSTRAINT [DF__SystemLet__readF__42ACE4D4]  DEFAULT ((0)),
 CONSTRAINT [PK_SystemLetter] PRIMARY KEY CLUSTERED 
(
	[letter_uid] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_SystemLetter] ON [dbo].[SystemLetter] 
(
	[receiver_uid] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[查询]    脚本日期: 12/02/2011 11:55:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[查询](
	[npc_id] [bigint] NOT NULL,
	[line_id] [int] NOT NULL,
	[owner_id] [bigint] NOT NULL,
	[flag_id] [int] NOT NULL,
	[flag] [int] NOT NULL
) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[QuestFlag]    脚本日期: 12/02/2011 11:55:37 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[QuestFlag](
	[char_id] [bigint] NOT NULL,
	[flag_id] [int] NOT NULL,
	[flag] [int] NOT NULL CONSTRAINT [DF__QuestFlag__flag__2E70E1FD]  DEFAULT ((0)),
 CONSTRAINT [PK_QuestFlag] PRIMARY KEY CLUSTERED 
(
	[char_id] ASC,
	[flag_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_QuestFlag] ON [dbo].[QuestFlag] 
(
	[char_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[PartnerCollection]    脚本日期: 12/02/2011 11:55:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[PartnerCollection](
	[collection_uid] [bigint] IDENTITY(1,1) NOT NULL,
	[collection_id] [bigint] NOT NULL,
	[char_id] [bigint] NOT NULL,
 CONSTRAINT [PK_PartnerCollection] PRIMARY KEY CLUSTERED 
(
	[collection_uid] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_PartnerCollection] ON [dbo].[PartnerCollection] 
(
	[char_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[QuestNpcFlag]    脚本日期: 12/02/2011 11:55:38 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[QuestNpcFlag](
	[npc_id] [bigint] NOT NULL,
	[line_id] [int] NOT NULL CONSTRAINT [DF__QuestNpcF__line___3335971A]  DEFAULT ((255)),
	[owner_id] [bigint] NOT NULL CONSTRAINT [DF__QuestNpcF__owner__3429BB53]  DEFAULT ((0)),
	[flag_id] [int] NOT NULL,
	[flag] [int] NOT NULL CONSTRAINT [DF__QuestNpcFl__flag__351DDF8C]  DEFAULT ((0)),
 CONSTRAINT [PK_QuestNpcFlag] PRIMARY KEY CLUSTERED 
(
	[npc_id] ASC,
	[line_id] ASC,
	[owner_id] ASC,
	[flag_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[Item]    脚本日期: 12/02/2011 11:55:48 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Item](
	[item_uid] [bigint] IDENTITY(1,1) NOT NULL,
	[item_id] [bigint] NOT NULL,
	[owner_id] [bigint] NOT NULL,
	[bagIndex] [smallint] NOT NULL CONSTRAINT [DF__Item2__bagIndex__2FEF161B]  DEFAULT ((0)),
	[eq_element] [smallint] NOT NULL CONSTRAINT [DF__Item2__eq_elemen__30E33A54]  DEFAULT ((0)),
	[endure] [int] NOT NULL CONSTRAINT [DF__Item2__endure__31D75E8D]  DEFAULT ((0)),
	[mEndure] [int] NOT NULL CONSTRAINT [DF__Item2__mEndure__32CB82C6]  DEFAULT ((0)),
	[maker] [nvarchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Item2__maker__33BFA6FF]  DEFAULT (N''),
	[grade] [smallint] NOT NULL CONSTRAINT [DF__Item2__grade__34B3CB38]  DEFAULT ((0)),
	[upg_exp] [int] NOT NULL CONSTRAINT [DF__Item2__upg_exp__35A7EF71]  DEFAULT ((0)),
	[remain] [smallint] NOT NULL CONSTRAINT [DF__Item2__remain__369C13AA]  DEFAULT ((0)),
	[stack] [smallint] NOT NULL CONSTRAINT [DF__Item2__stack__379037E3]  DEFAULT ((1)),
	[base_STA] [int] NOT NULL CONSTRAINT [DF__Item2__base_STA__38845C1C]  DEFAULT ((0)),
	[base_SPR] [int] NOT NULL CONSTRAINT [DF__Item2__base_SPR__39788055]  DEFAULT ((0)),
	[base_STR] [int] NOT NULL CONSTRAINT [DF__Item2__base_STR__3A6CA48E]  DEFAULT ((0)),
	[base_CON] [int] NOT NULL CONSTRAINT [DF__Item2__base_CON__3B60C8C7]  DEFAULT ((0)),
	[base_AGI] [int] NOT NULL CONSTRAINT [DF__Item2__base_AGI__3C54ED00]  DEFAULT ((0)),
	[base_ATK] [int] NOT NULL CONSTRAINT [DF__Item2__base_ATK__3D491139]  DEFAULT ((0)),
	[base_DEF] [int] NOT NULL CONSTRAINT [DF__Item2__base_DEF__3E3D3572]  DEFAULT ((0)),
	[base_HIT] [int] NOT NULL CONSTRAINT [DF__Item2__base_HIT__3F3159AB]  DEFAULT ((0)),
	[base_EVA] [int] NOT NULL CONSTRAINT [DF__Item2__base_EVA__40257DE4]  DEFAULT ((0)),
	[base_POW] [int] NOT NULL CONSTRAINT [DF__Item2__base_POW__4119A21D]  DEFAULT ((0)),
	[base_SPD] [int] NOT NULL CONSTRAINT [DF__Item2__base_SPD__420DC656]  DEFAULT ((0)),
	[base_maxHP] [int] NOT NULL CONSTRAINT [DF__Item2__base_maxH__4301EA8F]  DEFAULT ((0)),
	[base_maxSP] [int] NOT NULL CONSTRAINT [DF__Item2__base_maxS__43F60EC8]  DEFAULT ((0)),
	[base_maxVP] [int] NOT NULL CONSTRAINT [DF__Item2__base_maxV__44EA3301]  DEFAULT ((0)),
	[upg_STA] [int] NOT NULL CONSTRAINT [DF__Item2__upg_STA__45DE573A]  DEFAULT ((0)),
	[upg_SPR] [int] NOT NULL CONSTRAINT [DF__Item2__upg_SPR__46D27B73]  DEFAULT ((0)),
	[upg_STR] [int] NOT NULL CONSTRAINT [DF__Item2__upg_STR__47C69FAC]  DEFAULT ((0)),
	[upg_CON] [int] NOT NULL CONSTRAINT [DF__Item2__upg_CON__48BAC3E5]  DEFAULT ((0)),
	[upg_AGI] [int] NOT NULL CONSTRAINT [DF__Item2__upg_AGI__49AEE81E]  DEFAULT ((0)),
	[upg_ATK] [int] NOT NULL CONSTRAINT [DF__Item2__upg_ATK__4AA30C57]  DEFAULT ((0)),
	[upg_DEF] [int] NOT NULL CONSTRAINT [DF__Item2__upg_DEF__4B973090]  DEFAULT ((0)),
	[upg_HIT] [int] NOT NULL CONSTRAINT [DF__Item2__upg_HIT__4C8B54C9]  DEFAULT ((0)),
	[upg_EVA] [int] NOT NULL CONSTRAINT [DF__Item2__upg_EVA__4D7F7902]  DEFAULT ((0)),
	[upg_POW] [int] NOT NULL CONSTRAINT [DF__Item2__upg_POW__4E739D3B]  DEFAULT ((0)),
	[upg_SPD] [int] NOT NULL CONSTRAINT [DF__Item2__upg_SPD__4F67C174]  DEFAULT ((0)),
	[upg_maxHP] [int] NOT NULL CONSTRAINT [DF__Item2__upg_maxHP__505BE5AD]  DEFAULT ((0)),
	[upg_maxSP] [int] NOT NULL CONSTRAINT [DF__Item2__upg_maxSP__515009E6]  DEFAULT ((0)),
	[upg_maxVP] [int] NOT NULL CONSTRAINT [DF__Item2__upg_maxVP__52442E1F]  DEFAULT ((0)),
	[eq_gem] [smallint] NOT NULL CONSTRAINT [DF__Item2__eq_gem__53385258]  DEFAULT ((0)),
	[inlay_gem0] [bigint] NOT NULL CONSTRAINT [DF__Item2__inlay_gem__542C7691]  DEFAULT ((0)),
	[inlay_gem1] [bigint] NOT NULL CONSTRAINT [DF__Item2__inlay_gem__55209ACA]  DEFAULT ((0)),
	[inlay_gem2] [bigint] NOT NULL CONSTRAINT [DF__Item2__inlay_gem__5614BF03]  DEFAULT ((0)),
	[inlay_gem3] [bigint] NOT NULL CONSTRAINT [DF__Item2__inlay_gem__5708E33C]  DEFAULT ((0)),
	[inlay_gem4] [bigint] NOT NULL CONSTRAINT [DF__Item2__inlay_gem__57FD0775]  DEFAULT ((0)),
	[inlay_gem5] [bigint] NOT NULL CONSTRAINT [DF__Item2__inlay_gem__58F12BAE]  DEFAULT ((0)),
	[inlay_gem6] [bigint] NOT NULL CONSTRAINT [DF__Item2__inlay_gem__59E54FE7]  DEFAULT ((0)),
	[inlay_gem7] [bigint] NOT NULL CONSTRAINT [DF__Item2__inlay_gem__5AD97420]  DEFAULT ((0)),
	[inlay_gem8] [bigint] NOT NULL CONSTRAINT [DF__Item2__inlay_gem__5BCD9859]  DEFAULT ((0)),
	[inlay_gem9] [bigint] NOT NULL CONSTRAINT [DF__Item2__inlay_gem__5CC1BC92]  DEFAULT ((0)),
	[inlay_STA] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_STA__5DB5E0CB]  DEFAULT ((0)),
	[inlay_SPR] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_SPR__5EAA0504]  DEFAULT ((0)),
	[inlay_STR] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_STR__5F9E293D]  DEFAULT ((0)),
	[inlay_CON] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_CON__60924D76]  DEFAULT ((0)),
	[inlay_AGI] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_AGI__618671AF]  DEFAULT ((0)),
	[inlay_ATK] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_ATK__627A95E8]  DEFAULT ((0)),
	[inlay_DEF] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_DEF__636EBA21]  DEFAULT ((0)),
	[inlay_HIT] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_HIT__6462DE5A]  DEFAULT ((0)),
	[inlay_EVA] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_EVA__65570293]  DEFAULT ((0)),
	[inlay_POW] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_POW__664B26CC]  DEFAULT ((0)),
	[inlay_SPD] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_SPD__673F4B05]  DEFAULT ((0)),
	[inlay_maxHP] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_max__68336F3E]  DEFAULT ((0)),
	[inlay_maxSP] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_max__69279377]  DEFAULT ((0)),
	[inlay_maxVP] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_max__6A1BB7B0]  DEFAULT ((0)),
	[addon] [int] NOT NULL CONSTRAINT [DF__Item2__addon__6B0FDBE9]  DEFAULT ((0)),
	[eqColor] [int] NOT NULL CONSTRAINT [DF__Item2__eqColor__6C040022]  DEFAULT ((0)),
	[quality] [int] NOT NULL CONSTRAINT [DF__Item2__quality__6CF8245B]  DEFAULT ((0)),
	[soulboundState] [smallint] NOT NULL CONSTRAINT [DF__Item2__soulbound__6DEC4894]  DEFAULT ((0)),
	[IdentifyState] [smallint] NOT NULL CONSTRAINT [DF__Item2__IdentifyS__6EE06CCD]  DEFAULT ((0)),
	[IdentifyState2] [smallint] NOT NULL CONSTRAINT [DF__Item2__IdentifyS__6FD49106]  DEFAULT ((0)),
	[strLv] [smallint] NOT NULL CONSTRAINT [DF__Item2__strLv__70C8B53F]  DEFAULT ((0)),
	[eqQuality] [smallint] NOT NULL CONSTRAINT [DF__Item2__eqQuality__71BCD978]  DEFAULT ((0)),
	[eqQuality2] [smallint] NOT NULL CONSTRAINT [DF__Item2__eqQuality__72B0FDB1]  DEFAULT ((0)),
	[ATK_Base] [int] NOT NULL CONSTRAINT [DF__Item2__ATK_Base__73A521EA]  DEFAULT ((0)),
	[HIT_Base] [int] NOT NULL CONSTRAINT [DF__Item2__HIT_Base__74994623]  DEFAULT ((0)),
	[DEF_Base] [int] NOT NULL CONSTRAINT [DF__Item2__DEF_Base__758D6A5C]  DEFAULT ((0)),
	[HP_Base] [int] NOT NULL CONSTRAINT [DF__Item2__HP_Base__76818E95]  DEFAULT ((0)),
	[SPD_Base] [int] NOT NULL CONSTRAINT [DF__Item2__SPD_Base__7775B2CE]  DEFAULT ((0)),
	[EVA_Base] [int] NOT NULL CONSTRAINT [DF__Item2__EVA_Base__7869D707]  DEFAULT ((0)),
	[SP_Base] [int] NOT NULL CONSTRAINT [DF__Item2__SP_Base__795DFB40]  DEFAULT ((0)),
	[POW_Base] [int] NOT NULL CONSTRAINT [DF__Item2__POW_Base__7A521F79]  DEFAULT ((0)),
	[ATK_Qual] [int] NOT NULL CONSTRAINT [DF__Item2__ATK_Qual__7B4643B2]  DEFAULT ((0)),
	[HIT_Qual] [int] NOT NULL CONSTRAINT [DF__Item2__HIT_Qual__7C3A67EB]  DEFAULT ((0)),
	[DEF_Qual] [int] NOT NULL CONSTRAINT [DF__Item2__DEF_Qual__7D2E8C24]  DEFAULT ((0)),
	[HP_Qual] [int] NOT NULL CONSTRAINT [DF__Item2__HP_Qual__7E22B05D]  DEFAULT ((0)),
	[SPD_Qual] [int] NOT NULL CONSTRAINT [DF__Item2__SPD_Qual__7F16D496]  DEFAULT ((0)),
	[EVA_Qual] [int] NOT NULL CONSTRAINT [DF__Item2__EVA_Qual__000AF8CF]  DEFAULT ((0)),
	[SP_Qual] [int] NOT NULL CONSTRAINT [DF__Item2__SP_Qual__00FF1D08]  DEFAULT ((0)),
	[POW_Qual] [int] NOT NULL CONSTRAINT [DF__Item2__POW_Qual__01F34141]  DEFAULT ((0)),
	[ATK_Strth] [int] NOT NULL CONSTRAINT [DF__Item2__ATK_Strth__02E7657A]  DEFAULT ((0)),
	[HIT_Strth] [int] NOT NULL CONSTRAINT [DF__Item2__HIT_Strth__03DB89B3]  DEFAULT ((0)),
	[DEF_Strth] [int] NOT NULL CONSTRAINT [DF__Item2__DEF_Strth__04CFADEC]  DEFAULT ((0)),
	[HP_Strth] [int] NOT NULL CONSTRAINT [DF__Item2__HP_Strth__05C3D225]  DEFAULT ((0)),
	[SPD_Strth] [int] NOT NULL CONSTRAINT [DF__Item2__SPD_Strth__06B7F65E]  DEFAULT ((0)),
	[EVA_Strth] [int] NOT NULL CONSTRAINT [DF__Item2__EVA_Strth__07AC1A97]  DEFAULT ((0)),
	[SP_Strth] [int] NOT NULL CONSTRAINT [DF__Item2__SP_Strth__08A03ED0]  DEFAULT ((0)),
	[POW_Strth] [int] NOT NULL CONSTRAINT [DF__Item2__POW_Strth__09946309]  DEFAULT ((0)),
	[ExpireDate] [datetime] NULL,
	[Value1] [int] NOT NULL CONSTRAINT [DF__Item2__Value1__0A888742]  DEFAULT ((0)),
	[Value2] [int] NOT NULL CONSTRAINT [DF__Item2__Value2__0B7CAB7B]  DEFAULT ((0)),
	[Value3] [int] NOT NULL CONSTRAINT [DF__Item2__Value3__0C70CFB4]  DEFAULT ((0)),
	[buff_id] [int] NOT NULL CONSTRAINT [DF__Item2__buff_id__0D64F3ED]  DEFAULT ((0)),
	[buff_Value1] [bigint] NOT NULL CONSTRAINT [DF__Item2__buff_Valu__0E591826]  DEFAULT ((0)),
	[buff_Value2] [bigint] NOT NULL CONSTRAINT [DF__Item2__buff_Valu__0F4D3C5F]  DEFAULT ((0)),
	[buff_Value3] [bigint] NOT NULL CONSTRAINT [DF__Item2__buff_Valu__10416098]  DEFAULT ((0)),
	[buff_CoolDown] [bigint] NOT NULL CONSTRAINT [DF__Item2__buff_Cool__113584D1]  DEFAULT ((0)),
	[buff_Pro] [smallint] NOT NULL CONSTRAINT [DF__Item2__buff_Pro__1229A90A]  DEFAULT ((0)),
	[inWareHouse] [tinyint] NOT NULL CONSTRAINT [DF__Item2__inWareHou__131DCD43]  DEFAULT ((0)),
	[lock] [tinyint] NOT NULL CONSTRAINT [DF__Item2__lock__1411F17C]  DEFAULT ((0)),
	[skill_id] [int] NOT NULL CONSTRAINT [DF__Item2__skill_id__150615B5]  DEFAULT ((0)),
	[WindAtt] [int] NULL CONSTRAINT [DF__Item2__WindAtt__15FA39EE]  DEFAULT ((0)),
	[EarthAtt] [int] NULL CONSTRAINT [DF__Item2__EarthAtt__16EE5E27]  DEFAULT ((0)),
	[WaterAtt] [int] NULL CONSTRAINT [DF__Item2__WaterAtt__17E28260]  DEFAULT ((0)),
	[FireAtt] [int] NULL CONSTRAINT [DF__Item2__FireAtt__18D6A699]  DEFAULT ((0)),
	[WindAnti] [int] NULL CONSTRAINT [DF__Item2__WindAnti__19CACAD2]  DEFAULT ((0)),
	[EarthAnti] [int] NULL CONSTRAINT [DF__Item2__EarthAnti__1ABEEF0B]  DEFAULT ((0)),
	[WaterAnti] [int] NULL CONSTRAINT [DF__Item2__WaterAnti__1BB31344]  DEFAULT ((0)),
	[FireAnti] [int] NULL CONSTRAINT [DF__Item2__FireAnti__1CA7377D]  DEFAULT ((0)),
	[WindIngr] [int] NULL CONSTRAINT [DF__Item2__WindIngr__1D9B5BB6]  DEFAULT ((0)),
	[EarthIngr] [int] NULL CONSTRAINT [DF__Item2__EarthIngr__1E8F7FEF]  DEFAULT ((0)),
	[WaterIngr] [int] NULL CONSTRAINT [DF__Item2__WaterIngr__1F83A428]  DEFAULT ((0)),
	[FireIngr] [int] NULL CONSTRAINT [DF__Item2__FireIngr__2077C861]  DEFAULT ((0)),
	[WindDecrDownLimit] [int] NULL CONSTRAINT [DF__Item2__WindDecrD__216BEC9A]  DEFAULT ((0)),
	[EarthDecrDownLimit] [int] NULL CONSTRAINT [DF__Item2__EarthDecr__226010D3]  DEFAULT ((0)),
	[WaterDecrDownLimit] [int] NULL CONSTRAINT [DF__Item2__WaterDecr__2354350C]  DEFAULT ((0)),
	[FireDecrDownLimit] [int] NULL CONSTRAINT [DF__Item2__FireDecrD__24485945]  DEFAULT ((0)),
	[inlay_WindAtt] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Win__253C7D7E]  DEFAULT ((0)),
	[inlay_WindAnti] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Win__2630A1B7]  DEFAULT ((0)),
	[inlay_WindIngr] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Win__2724C5F0]  DEFAULT ((0)),
	[inlay_WindDescDown] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Win__2818EA29]  DEFAULT ((0)),
	[inlay_FireAtt] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Fir__290D0E62]  DEFAULT ((0)),
	[inlay_FireAnti] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Fir__2A01329B]  DEFAULT ((0)),
	[inlay_FireIngr] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Fir__2AF556D4]  DEFAULT ((0)),
	[inlay_FireDescDown] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Fir__2BE97B0D]  DEFAULT ((0)),
	[inlay_EarthAtt] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Ear__2CDD9F46]  DEFAULT ((0)),
	[inlay_EarthAnti] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Ear__2DD1C37F]  DEFAULT ((0)),
	[inlay_EarthIngr] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Ear__2EC5E7B8]  DEFAULT ((0)),
	[inlay_EarthDescDown] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Ear__2FBA0BF1]  DEFAULT ((0)),
	[inlay_WaterAtt] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Wat__30AE302A]  DEFAULT ((0)),
	[inlay_WaterAnti] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Wat__31A25463]  DEFAULT ((0)),
	[inlay_WaterIngr] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Wat__3296789C]  DEFAULT ((0)),
	[inlay_WaterDescDown] [int] NOT NULL CONSTRAINT [DF__Item2__inlay_Wat__338A9CD5]  DEFAULT ((0)),
 CONSTRAINT [PK_Item] PRIMARY KEY CLUSTERED 
(
	[item_uid] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_Item] ON [dbo].[Item] 
(
	[owner_id] ASC,
	[inWareHouse] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[Sibling]    脚本日期: 12/02/2011 11:55:49 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Sibling](
	[sibling_id] [bigint] IDENTITY(1,1) NOT NULL,
	[sibling_title_prefix] [nvarchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Sibling__sibling__37FA4C37]  DEFAULT (N''),
	[member_id1] [bigint] NOT NULL CONSTRAINT [DF__Sibling__member___38EE7070]  DEFAULT ((0)),
	[member_title_suffix1] [nvarchar](10) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Sibling__member___39E294A9]  DEFAULT (N''),
	[member_id2] [bigint] NOT NULL CONSTRAINT [DF__Sibling__member___3AD6B8E2]  DEFAULT ((0)),
	[member_title_suffix2] [nvarchar](10) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Sibling__member___3BCADD1B]  DEFAULT (N''),
	[member_id3] [bigint] NOT NULL CONSTRAINT [DF__Sibling__member___3CBF0154]  DEFAULT ((0)),
	[member_title_suffix3] [nvarchar](10) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Sibling__member___3DB3258D]  DEFAULT (N''),
	[member_id4] [bigint] NOT NULL CONSTRAINT [DF__Sibling__member___3EA749C6]  DEFAULT ((0)),
	[member_title_suffix4] [nvarchar](10) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Sibling__member___3F9B6DFF]  DEFAULT (N''),
	[member_id5] [bigint] NOT NULL CONSTRAINT [DF__Sibling__member___408F9238]  DEFAULT ((0)),
	[member_title_suffix5] [nvarchar](10) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Sibling__member___4183B671]  DEFAULT (N''),
	[member_id6] [bigint] NOT NULL CONSTRAINT [DF__Sibling__member___4277DAAA]  DEFAULT ((0)),
	[member_title_suffix6] [nvarchar](10) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Sibling__member___436BFEE3]  DEFAULT (N''),
	[member_id7] [bigint] NOT NULL CONSTRAINT [DF__Sibling__member___4460231C]  DEFAULT ((0)),
	[member_title_suffix7] [nvarchar](10) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Sibling__member___45544755]  DEFAULT (N''),
	[member_id8] [bigint] NOT NULL CONSTRAINT [DF__Sibling__member___46486B8E]  DEFAULT ((0)),
	[member_title_suffix8] [nvarchar](10) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Sibling__member___473C8FC7]  DEFAULT (N''),
	[member_id9] [bigint] NOT NULL CONSTRAINT [DF__Sibling__member___4830B400]  DEFAULT ((0)),
	[member_title_suffix9] [nvarchar](10) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Sibling__member___4924D839]  DEFAULT (N''),
	[member_id10] [bigint] NOT NULL CONSTRAINT [DF__Sibling__member___4A18FC72]  DEFAULT ((0)),
	[member_title_suffix10] [nvarchar](10) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Sibling__member___4B0D20AB]  DEFAULT (N''),
 CONSTRAINT [PK_Sibling] PRIMARY KEY CLUSTERED 
(
	[sibling_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[Character]    脚本日期: 12/02/2011 11:55:57 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Character](
	[void] [tinyint] NOT NULL CONSTRAINT [DF__Character__void__345EC57D]  DEFAULT ((0)),
	[acct_id] [bigint] NOT NULL,
	[char_id] [bigint] IDENTITY(1,1) NOT NULL,
	[nickName] [nchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Character__nickN__3552E9B6]  DEFAULT (N''),
	[sex] [smallint] NOT NULL CONSTRAINT [DF__Character__sex__36470DEF]  DEFAULT ((0)),
	[cclass] [smallint] NOT NULL CONSTRAINT [DF__Character__cclas__373B3228]  DEFAULT ((1)),
	[faction] [smallint] NOT NULL CONSTRAINT [DF__Character__facti__382F5661]  DEFAULT ((0)),
	[level] [int] NOT NULL CONSTRAINT [DF__Character__level__39237A9A]  DEFAULT ((0)),
	[exp] [bigint] NOT NULL CONSTRAINT [DF__Character__exp__3A179ED3]  DEFAULT ((0)),
	[STA] [int] NOT NULL CONSTRAINT [DF__Character__STA__3B0BC30C]  DEFAULT ((0)),
	[SPR] [int] NOT NULL CONSTRAINT [DF__Character__SPR__3BFFE745]  DEFAULT ((0)),
	[STR] [int] NOT NULL CONSTRAINT [DF__Character__STR__3CF40B7E]  DEFAULT ((0)),
	[CON] [int] NOT NULL CONSTRAINT [DF__Character__CON__3DE82FB7]  DEFAULT ((0)),
	[AGI] [int] NOT NULL CONSTRAINT [DF__Character__AGI__3EDC53F0]  DEFAULT ((0)),
	[attrPoint] [int] NOT NULL CONSTRAINT [DF__Character__attrP__3FD07829]  DEFAULT ((0)),
	[HP] [bigint] NOT NULL CONSTRAINT [DF__Character__HP__40C49C62]  DEFAULT ((0)),
	[mHP] [bigint] NOT NULL CONSTRAINT [DF__Character__mHP__41B8C09B]  DEFAULT ((0)),
	[maxHP] [bigint] NOT NULL CONSTRAINT [DF__Character__maxHP__42ACE4D4]  DEFAULT ((0)),
	[SP] [bigint] NOT NULL CONSTRAINT [DF__Character__SP__43A1090D]  DEFAULT ((0)),
	[mSP] [bigint] NOT NULL CONSTRAINT [DF__Character__mSP__44952D46]  DEFAULT ((0)),
	[maxSP] [bigint] NOT NULL CONSTRAINT [DF__Character__maxSP__4589517F]  DEFAULT ((0)),
	[DP] [int] NOT NULL CONSTRAINT [DF__Character__DP__467D75B8]  DEFAULT ((0)),
	[mDP] [int] NOT NULL CONSTRAINT [DF__Character__mDP__477199F1]  DEFAULT ((0)),
	[maxDP] [int] NOT NULL CONSTRAINT [DF__Character__maxDP__4865BE2A]  DEFAULT ((0)),
	[WC] [int] NOT NULL CONSTRAINT [DF__Character__WC__4959E263]  DEFAULT ((0)),
	[maxWC] [int] NOT NULL CONSTRAINT [DF__Character__maxWC__4A4E069C]  DEFAULT ((0)),
	[WcExp] [int] NOT NULL CONSTRAINT [DF__Character__WcExp__4B422AD5]  DEFAULT ((0)),
	[Energy] [int] NOT NULL CONSTRAINT [DF__Character__Energ__39E294A9]  DEFAULT ((0)),
	[maxEnergy] [int] NOT NULL CONSTRAINT [DF__Character__maxEn__3AD6B8E2]  DEFAULT ((0)),
	[VP] [int] NOT NULL CONSTRAINT [DF__Character__VP__4C364F0E]  DEFAULT ((0)),
	[maxVP] [int] NOT NULL CONSTRAINT [DF__Character__maxVP__4D2A7347]  DEFAULT ((0)),
	[array0] [int] NOT NULL CONSTRAINT [DF__Character__array__4E1E9780]  DEFAULT ((0)),
	[array1] [int] NOT NULL CONSTRAINT [DF__Character__array__4F12BBB9]  DEFAULT ((0)),
	[array2] [int] NOT NULL CONSTRAINT [DF__Character__array__5006DFF2]  DEFAULT ((0)),
	[arrayExp0] [int] NOT NULL CONSTRAINT [DF__Character__array__50FB042B]  DEFAULT ((0)),
	[arrayExp1] [int] NOT NULL CONSTRAINT [DF__Character__array__51EF2864]  DEFAULT ((0)),
	[arrayExp2] [int] NOT NULL CONSTRAINT [DF__Character__array__52E34C9D]  DEFAULT ((0)),
	[curArray] [int] NOT NULL CONSTRAINT [DF__Character__curAr__53D770D6]  DEFAULT ((0)),
	[goodness] [int] NOT NULL CONSTRAINT [DF__Character__goodn__54CB950F]  DEFAULT ((0)),
	[honor] [bigint] NOT NULL CONSTRAINT [DF__Character__honor__55BFB948]  DEFAULT ((0)),
	[title] [nvarchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Character__title__56B3DD81]  DEFAULT (N''),
	[manor] [bigint] NOT NULL CONSTRAINT [DF__Character__manor__57A801BA]  DEFAULT ((0)),
	[fDonate] [bigint] NOT NULL CONSTRAINT [DF__Character__fDona__589C25F3]  DEFAULT ((0)),
	[totalFDonate] [bigint] NOT NULL CONSTRAINT [DF__Character__total__59904A2C]  DEFAULT ((0)),
	[mDonate] [bigint] NOT NULL CONSTRAINT [DF__Character__mDona__5A846E65]  DEFAULT ((0)),
	[totalMDonate] [bigint] NOT NULL CONSTRAINT [DF__Character__total__5B78929E]  DEFAULT ((0)),
	[money] [bigint] NOT NULL CONSTRAINT [DF__Character__money__5C6CB6D7]  DEFAULT ((0)),
	[bankMoney] [bigint] NOT NULL CONSTRAINT [DF__Character__bankM__5D60DB10]  DEFAULT ((0)),
	[partner] [bigint] NOT NULL CONSTRAINT [DF__Character__partn__5E54FF49]  DEFAULT ((0)),
	[pet] [bigint] NOT NULL CONSTRAINT [DF__Character__pet__5F492382]  DEFAULT ((0)),
	[maxPartner] [smallint] NOT NULL CONSTRAINT [DF__Character__maxPa__603D47BB]  DEFAULT ((0)),
	[maxPet] [smallint] NOT NULL CONSTRAINT [DF__Character__maxPe__61316BF4]  DEFAULT ((0)),
	[map_id] [int] NOT NULL CONSTRAINT [DF__Character__map_i__6225902D]  DEFAULT ((0)),
	[map_x] [int] NOT NULL CONSTRAINT [DF__Character__map_x__6319B466]  DEFAULT ((0)),
	[map_y] [int] NOT NULL CONSTRAINT [DF__Character__map_y__640DD89F]  DEFAULT ((0)),
	[map_ownerId] [int] NOT NULL CONSTRAINT [DF__Character__map_o__6501FCD8]  DEFAULT ((0)),
	[reborn_map] [int] NOT NULL CONSTRAINT [DF__Character__rebor__65F62111]  DEFAULT ((0)),
	[reborn_x] [int] NOT NULL CONSTRAINT [DF__Character__rebor__66EA454A]  DEFAULT ((0)),
	[reborn_y] [int] NOT NULL CONSTRAINT [DF__Character__rebor__67DE6983]  DEFAULT ((0)),
	[photo_id] [int] NOT NULL CONSTRAINT [DF__Character__photo__68D28DBC]  DEFAULT ((0)),
	[hairStyle1] [int] NOT NULL CONSTRAINT [DF__Character__hairS__69C6B1F5]  DEFAULT ((0)),
	[hairStyle2] [int] NOT NULL CONSTRAINT [DF__Character__hairS__6ABAD62E]  DEFAULT ((0)),
	[hairColor] [int] NOT NULL CONSTRAINT [DF__Character__hairC__6BAEFA67]  DEFAULT ((0)),
	[eq_weapon] [bigint] NOT NULL CONSTRAINT [DF__Character__eq_we__6CA31EA0]  DEFAULT ((0)),
	[eq_weaponColor] [int] NOT NULL CONSTRAINT [DF__Character__eq_we__6D9742D9]  DEFAULT ((0)),
	[eq_headBand] [bigint] NOT NULL CONSTRAINT [DF__Character__eq_he__6E8B6712]  DEFAULT ((0)),
	[eq_headColor] [int] NOT NULL CONSTRAINT [DF__Character__eq_he__6F7F8B4B]  DEFAULT ((0)),
	[eq_cloth] [bigint] NOT NULL CONSTRAINT [DF__Character__eq_cl__7073AF84]  DEFAULT ((0)),
	[eq_clothColor] [int] NOT NULL CONSTRAINT [DF__Character__eq_cl__7167D3BD]  DEFAULT ((0)),
	[mount] [bigint] NOT NULL CONSTRAINT [DF__Character__mount__725BF7F6]  DEFAULT ((0)),
	[state] [smallint] NOT NULL CONSTRAINT [DF__Character__state__73501C2F]  DEFAULT ((0)),
	[buff] [nvarchar](1100) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Character__buff__74444068]  DEFAULT (N''),
	[shortcut0] [int] NOT NULL CONSTRAINT [DF__Character__short__753864A1]  DEFAULT ((0)),
	[shortcut1] [int] NOT NULL CONSTRAINT [DF__Character__short__762C88DA]  DEFAULT ((0)),
	[shortcut2] [int] NOT NULL CONSTRAINT [DF__Character__short__7720AD13]  DEFAULT ((0)),
	[shortcut3] [int] NOT NULL CONSTRAINT [DF__Character__short__7814D14C]  DEFAULT ((0)),
	[shortcut4] [int] NOT NULL CONSTRAINT [DF__Character__short__7908F585]  DEFAULT ((0)),
	[shortcut5] [int] NOT NULL CONSTRAINT [DF__Character__short__79FD19BE]  DEFAULT ((0)),
	[shortcut6] [int] NOT NULL CONSTRAINT [DF__Character__short__7AF13DF7]  DEFAULT ((0)),
	[shortcut7] [int] NOT NULL CONSTRAINT [DF__Character__short__7BE56230]  DEFAULT ((0)),
	[shortcut8] [int] NOT NULL CONSTRAINT [DF__Character__short__7CD98669]  DEFAULT ((0)),
	[shortcut9] [int] NOT NULL CONSTRAINT [DF__Character__short__7DCDAAA2]  DEFAULT ((0)),
	[PK_Value] [int] NOT NULL CONSTRAINT [DF__Character__PK_Va__7EC1CEDB]  DEFAULT ((0)),
	[org_hairStyle1] [int] NOT NULL CONSTRAINT [DF__Character__org_h__7FB5F314]  DEFAULT ((0)),
	[org_hairColor] [int] NOT NULL CONSTRAINT [DF__Character__org_h__00AA174D]  DEFAULT ((0)),
	[org_eq_cloth] [bigint] NOT NULL CONSTRAINT [DF__Character__org_e__019E3B86]  DEFAULT ((0)),
	[org_eq_clothColor] [int] NOT NULL CONSTRAINT [DF__Character__org_e__02925FBF]  DEFAULT ((0)),
	[friend_status] [smallint] NOT NULL CONSTRAINT [DF__Character__frien__038683F8]  DEFAULT ((0)),
	[shortcuttype0] [smallint] NOT NULL CONSTRAINT [DF__Character__short__047AA831]  DEFAULT ((0)),
	[shortcuttype1] [smallint] NOT NULL CONSTRAINT [DF__Character__short__056ECC6A]  DEFAULT ((0)),
	[shortcuttype2] [smallint] NOT NULL CONSTRAINT [DF__Character__short__0662F0A3]  DEFAULT ((0)),
	[shortcuttype3] [smallint] NOT NULL CONSTRAINT [DF__Character__short__075714DC]  DEFAULT ((0)),
	[shortcuttype4] [smallint] NOT NULL CONSTRAINT [DF__Character__short__084B3915]  DEFAULT ((0)),
	[shortcuttype5] [smallint] NOT NULL CONSTRAINT [DF__Character__short__093F5D4E]  DEFAULT ((0)),
	[shortcuttype6] [smallint] NOT NULL CONSTRAINT [DF__Character__short__0A338187]  DEFAULT ((0)),
	[shortcuttype7] [smallint] NOT NULL CONSTRAINT [DF__Character__short__0B27A5C0]  DEFAULT ((0)),
	[shortcuttype8] [smallint] NOT NULL CONSTRAINT [DF__Character__short__0C1BC9F9]  DEFAULT ((0)),
	[shortcuttype9] [smallint] NOT NULL CONSTRAINT [DF__Character__short__0D0FEE32]  DEFAULT ((0)),
	[friend_icon] [smallint] NOT NULL CONSTRAINT [DF__Character__frien__0E04126B]  DEFAULT ((0)),
	[friend_about] [nvarchar](80) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Character__frien__0EF836A4]  DEFAULT (N''),
	[friend_onlineAutoReply] [nvarchar](80) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Character__frien__0FEC5ADD]  DEFAULT (N''),
	[friend_offlineAutoReply] [nvarchar](80) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Character__frien__10E07F16]  DEFAULT (N''),
	[speakCount] [int] NOT NULL CONSTRAINT [DF__Character__speak__11D4A34F]  DEFAULT ((0)),
	[offlineTime] [datetime] NULL,
	[TP] [int] NOT NULL CONSTRAINT [DF__Character__TP__12C8C788]  DEFAULT ((0)),
	[speakBlock] [datetime] NULL,
	[hawkerTime] [bigint] NOT NULL CONSTRAINT [DF__Character__hawke__13BCEBC1]  DEFAULT ((0)),
	[SMoney] [bigint] NOT NULL CONSTRAINT [DF__Character__SMone__14B10FFA]  DEFAULT ((0)),
	[availBackPack] [tinyint] NOT NULL CONSTRAINT [DF__Character__avail__15A53433]  DEFAULT ((0)),
	[availItemWareHouse] [tinyint] NOT NULL CONSTRAINT [DF__Character__avail__1699586C]  DEFAULT ((1)),
	[availPartnerWareHouse] [tinyint] NOT NULL CONSTRAINT [DF__Character__avail__178D7CA5]  DEFAULT ((0)),
	[availPetWareHouse] [tinyint] NOT NULL CONSTRAINT [DF__Character__avail__1881A0DE]  DEFAULT ((0)),
	[PvPScoreSingle] [bigint] NOT NULL CONSTRAINT [DF__Character__PvPSc__1975C517]  DEFAULT ((0)),
	[deleteExpiryDate] [datetime] NULL,
	[bankLock] [tinyint] NOT NULL CONSTRAINT [DF__Character__bankL__1A69E950]  DEFAULT ((0)),
	[siblingId] [bigint] NOT NULL CONSTRAINT [DF__Character__sibli__1B5E0D89]  DEFAULT ((0)),
	[mark] [smallint] NOT NULL CONSTRAINT [DF__Character__mark__1C5231C2]  DEFAULT ((0)),
	[wantedReward] [bigint] NOT NULL CONSTRAINT [DF__Character__wante__1D4655FB]  DEFAULT ((0)),
	[guild_uid] [bigint] NOT NULL CONSTRAINT [DF__Character__guild__1E3A7A34]  DEFAULT ((0)),
	[HistoryGenAccmulation] [bigint] NULL CONSTRAINT [DF__Character__Histo__1F2E9E6D]  DEFAULT ((0)),
	[CurGenAccmulation] [bigint] NULL CONSTRAINT [DF__Character__CurGe__2022C2A6]  DEFAULT ((0)),
	[SingleWarScoreTotal] [bigint] NOT NULL CONSTRAINT [DF__Character__Singl__3BCADD1B]  DEFAULT ((0)),
	[SingleWarScoreTemp] [bigint] NOT NULL CONSTRAINT [DF__Character__Singl__3CBF0154]  DEFAULT ((0)),
	[SingleWarScore] [bigint] NOT NULL CONSTRAINT [DF__Character__Singl__3DB3258D]  DEFAULT ((0)),
	[SingleWarGroup] [smallint] NOT NULL CONSTRAINT [DF__Character__Singl__3EA749C6]  DEFAULT ((0)),
	[weaponPoints] [int] NOT NULL CONSTRAINT [DF__Character__weapo__6FE99F9F]  DEFAULT ((0)),
	[BusinessMoney] [bigint] NULL CONSTRAINT [DF__Character__Busin__70DDC3D8]  DEFAULT ((0)),
 CONSTRAINT [PK_Character] PRIMARY KEY CLUSTERED 
(
	[char_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_Character1] ON [dbo].[Character] 
(
	[acct_id] ASC
)
INCLUDE ( [char_id]) WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_Character2] ON [dbo].[Character] 
(
	[void] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_Character3] ON [dbo].[Character] 
(
	[nickName] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[ChargeShop]    脚本日期: 12/02/2011 11:55:59 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ChargeShop](
	[ChargeShopID] [bigint] NOT NULL,
	[Name] [nvarchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__ChargeShop__Name__451F3D2B]  DEFAULT (N''),
	[Active] [smallint] NOT NULL CONSTRAINT [DF__ChargeSho__Activ__46136164]  DEFAULT ((0)),
	[Type] [smallint] NOT NULL CONSTRAINT [DF__ChargeShop__Type__4707859D]  DEFAULT ((0)),
	[ItemType] [smallint] NOT NULL CONSTRAINT [DF__ChargeSho__ItemT__47FBA9D6]  DEFAULT ((0)),
	[LV] [int] NOT NULL CONSTRAINT [DF__ChargeShop__LV__48EFCE0F]  DEFAULT ((0)),
	[PreviewType] [smallint] NOT NULL CONSTRAINT [DF__ChargeSho__Previ__49E3F248]  DEFAULT ((0)),
	[ItemID] [bigint] NOT NULL CONSTRAINT [DF__ChargeSho__ItemI__4AD81681]  DEFAULT ((0)),
	[YuanBao] [bigint] NOT NULL CONSTRAINT [DF__ChargeSho__YuanB__4BCC3ABA]  DEFAULT ((0)),
	[Discount] [smallint] NOT NULL,
	[TotalStock] [int] NOT NULL CONSTRAINT [DF__ChargeSho__Total__4CC05EF3]  DEFAULT ((0)),
	[LimitType] [smallint] NOT NULL CONSTRAINT [DF__ChargeSho__Limit__4DB4832C]  DEFAULT ((0)),
	[StartTime] [datetime] NULL,
	[EndTime] [datetime] NULL,
	[NeedRestore] [smallint] NOT NULL CONSTRAINT [DF__ChargeSho__NeedR__4EA8A765]  DEFAULT ((0)),
	[Remain] [int] NOT NULL CONSTRAINT [DF__ChargeSho__Remai__4F9CCB9E]  DEFAULT ((0)),
	[LastOrderDate] [datetime] NULL,
	[TotalSell] [bigint] NOT NULL CONSTRAINT [DF__ChargeSho__Total__5090EFD7]  DEFAULT ((0)),
 CONSTRAINT [PK_ChargeShop] PRIMARY KEY CLUSTERED 
(
	[ChargeShopID] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_ChargeShop] ON [dbo].[ChargeShop] 
(
	[Active] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[SellYuanBao]    脚本日期: 12/02/2011 11:55:59 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[SellYuanBao](
	[sellYuanBao_id] [bigint] IDENTITY(1,1) NOT NULL,
	[char_id] [bigint] NOT NULL CONSTRAINT [DF__SellYuanB__char___4589517F]  DEFAULT ((0)),
	[charName] [nchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__SellYuanB__charN__467D75B8]  DEFAULT (N''),
	[sellType] [smallint] NOT NULL CONSTRAINT [DF__SellYuanB__sellT__477199F1]  DEFAULT ((0)),
	[totalYBT] [bigint] NOT NULL CONSTRAINT [DF__SellYuanB__total__4865BE2A]  DEFAULT ((0)),
	[moneyPerYBT] [bigint] NOT NULL CONSTRAINT [DF__SellYuanB__money__4959E263]  DEFAULT ((0)),
	[soldYBT] [bigint] NOT NULL CONSTRAINT [DF__SellYuanB__soldY__4A4E069C]  DEFAULT ((0)),
	[expireDate] [datetime] NOT NULL,
 CONSTRAINT [PK_SellYuanBao] PRIMARY KEY CLUSTERED 
(
	[sellYuanBao_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_SellYuanBao] ON [dbo].[SellYuanBao] 
(
	[char_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[Guild]    脚本日期: 12/02/2011 11:56:06 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Guild](
	[guild_uid] [bigint] IDENTITY(1,1) NOT NULL,
	[name] [nchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Guild__name__4D2A7347]  DEFAULT (N''),
	[creator] [nchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Guild__creator__4E1E9780]  DEFAULT (N''),
	[master] [nchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Guild__master__4F12BBB9]  DEFAULT (N''),
	[alliance] [bigint] NOT NULL CONSTRAINT [DF__Guild__alliance__5006DFF2]  DEFAULT ((0)),
	[enemy] [bigint] NOT NULL CONSTRAINT [DF__Guild__enemy__50FB042B]  DEFAULT ((0)),
	[secMaster] [nchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Guild__secMaster__51EF2864]  DEFAULT (N''),
	[level] [int] NOT NULL CONSTRAINT [DF__Guild__level__52E34C9D]  DEFAULT ((0)),
	[prosper] [bigint] NOT NULL CONSTRAINT [DF__Guild__prosper__53D770D6]  DEFAULT ((0)),
	[maxProsper] [int] NOT NULL CONSTRAINT [DF__Guild__maxProspe__54CB950F]  DEFAULT ((10000)),
	[fund] [bigint] NOT NULL CONSTRAINT [DF__Guild__fund__55BFB948]  DEFAULT ((0)),
	[totalMember] [int] NOT NULL CONSTRAINT [DF__Guild__totalMemb__56B3DD81]  DEFAULT ((0)),
	[maxMember] [int] NOT NULL CONSTRAINT [DF__Guild__maxMember__57A801BA]  DEFAULT ((60)),
	[aim] [nvarchar](100) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Guild__aim__589C25F3]  DEFAULT (N''),
	[rule] [nvarchar](300) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Guild__rule__59904A2C]  DEFAULT (N''),
	[guildPvPScore] [bigint] NOT NULL CONSTRAINT [DF__Guild__guildPvPS__5A846E65]  DEFAULT ((0)),
	[guildPvPBid] [bigint] NOT NULL CONSTRAINT [DF__Guild__guildPvPB__5B78929E]  DEFAULT ((0)),
	[guildPvPGroup] [smallint] NOT NULL CONSTRAINT [DF__Guild__guildPvPG__5C6CB6D7]  DEFAULT ((0)),
	[groupPvPVSGuild] [nvarchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Guild__groupPvPV__5D60DB10]  DEFAULT (N''),
	[manorScale] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorScal__5E54FF49]  DEFAULT ((0)),
	[manorRoom] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorRoom__5F492382]  DEFAULT ((0)),
	[manorMaterial] [bigint] NOT NULL CONSTRAINT [DF__Guild__manorMate__603D47BB]  DEFAULT ((0)),
	[manorGuard] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorGuar__61316BF4]  DEFAULT ((0)),
	[manorGuardExp] [bigint] NOT NULL CONSTRAINT [DF__Guild__manorGuar__6225902D]  DEFAULT ((0)),
	[manorTrainPlayerExPow] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorTrai__6319B466]  DEFAULT ((0)),
	[manorTrainPlayerInPow] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorTrai__640DD89F]  DEFAULT ((0)),
	[manorTrainPartnerExPow] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorTrai__6501FCD8]  DEFAULT ((0)),
	[manorTrainPartnerInPow] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorTrai__65F62111]  DEFAULT ((0)),
	[manorRoomDrugLv] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorRoom__66EA454A]  DEFAULT ((0)),
	[manorRoomCookLv] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorRoom__67DE6983]  DEFAULT ((0)),
	[manorRoomWineLv] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorRoom__68D28DBC]  DEFAULT ((0)),
	[manorRoomHPLv] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorRoom__69C6B1F5]  DEFAULT ((0)),
	[manorRoomSPLv] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorRoom__6ABAD62E]  DEFAULT ((0)),
	[manorRoomHuntingLv] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorRoom__6BAEFA67]  DEFAULT ((0)),
	[manorRoomMineLv] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorRoom__6CA31EA0]  DEFAULT ((0)),
	[manorRoomGatherLv] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorRoom__6D9742D9]  DEFAULT ((0)),
	[manorMaintainNum] [bigint] NOT NULL CONSTRAINT [DF__Guild__manorMain__6E8B6712]  DEFAULT ((0)),
	[lastMaintainDate] [datetime] NULL,
	[manorAura] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorAura__6F7F8B4B]  DEFAULT ((0)),
	[offlinetime] [datetime] NULL,
	[clearBusinessDate] [datetime] NULL,
	[autoManageBusiness] [tinyint] NOT NULL CONSTRAINT [DF__Guild__autoManag__7073AF84]  DEFAULT ((0)),
	[manorStudy] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorStud__7167D3BD]  DEFAULT ((0)),
	[manorMinerals] [bigint] NOT NULL CONSTRAINT [DF__Guild__manorMine__725BF7F6]  DEFAULT ((0)),
	[manorSundries] [bigint] NOT NULL CONSTRAINT [DF__Guild__manorSund__73501C2F]  DEFAULT ((0)),
	[manorLeather] [bigint] NOT NULL CONSTRAINT [DF__Guild__manorLeat__74444068]  DEFAULT ((0)),
	[manorCollege] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorColl__753864A1]  DEFAULT ((0)),
	[manorCollegeStudySwitch] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorColl__762C88DA]  DEFAULT ((0)),
	[manorBuildProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorBuil__7720AD13]  DEFAULT ((0)),
	[manorBuildSwitch] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorBuil__7814D14C]  DEFAULT ((0)),
	[manorCoffers] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorCoff__7908F585]  DEFAULT ((0)),
	[manorElement] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorElem__79FD19BE]  DEFAULT ((0)),
	[manorElementWindCost] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorElem__7AF13DF7]  DEFAULT ((0)),
	[manorElementWindCostProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorElem__7BE56230]  DEFAULT ((0)),
	[manorElementWindPower] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorElem__7CD98669]  DEFAULT ((0)),
	[manorElementWindPowerProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorElem__7DCDAAA2]  DEFAULT ((0)),
	[manorElementEarthCost] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorElem__7EC1CEDB]  DEFAULT ((0)),
	[manorElementEarthCostProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorElem__7FB5F314]  DEFAULT ((0)),
	[manorElementEarthPower] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorElem__00AA174D]  DEFAULT ((0)),
	[manorElementEarthPowerProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorElem__019E3B86]  DEFAULT ((0)),
	[manorElementWaterCost] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorElem__02925FBF]  DEFAULT ((0)),
	[manorElementWaterCostProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorElem__038683F8]  DEFAULT ((0)),
	[manorElementWaterPower] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorElem__047AA831]  DEFAULT ((0)),
	[manorElementWaterPowerProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorElem__056ECC6A]  DEFAULT ((0)),
	[manorElementFireCost] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorElem__0662F0A3]  DEFAULT ((0)),
	[manorElementFireCostProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorElem__075714DC]  DEFAULT ((0)),
	[manorElementFirePower] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorElem__084B3915]  DEFAULT ((0)),
	[manorElementFirePowerProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorElem__093F5D4E]  DEFAULT ((0)),
	[manorElementStudySwitch] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorElem__0A338187]  DEFAULT ((1)),
	[manorBoon] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorBoon__0B27A5C0]  DEFAULT ((0)),
	[manorBoonItemID1] [bigint] NOT NULL CONSTRAINT [DF__Guild__manorBoon__0C1BC9F9]  DEFAULT ((0)),
	[manorBoonItemCount1] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorBoon__0D0FEE32]  DEFAULT ((0)),
	[manorBoonItemID2] [bigint] NOT NULL CONSTRAINT [DF__Guild__manorBoon__0E04126B]  DEFAULT ((0)),
	[manorBoonItemCount2] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorBoon__0EF836A4]  DEFAULT ((0)),
	[manorBoonItemID3] [bigint] NOT NULL CONSTRAINT [DF__Guild__manorBoon__0FEC5ADD]  DEFAULT ((0)),
	[manorBoonItemCount3] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorBoon__10E07F16]  DEFAULT ((0)),
	[manorBoonItemID4] [bigint] NOT NULL CONSTRAINT [DF__Guild__manorBoon__11D4A34F]  DEFAULT ((0)),
	[manorBoonItemCount4] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorBoon__12C8C788]  DEFAULT ((0)),
	[manorBoonItemID5] [bigint] NOT NULL CONSTRAINT [DF__Guild__manorBoon__13BCEBC1]  DEFAULT ((0)),
	[manorBoonItemCount5] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorBoon__14B10FFA]  DEFAULT ((0)),
	[manorBoonItemID6] [bigint] NOT NULL CONSTRAINT [DF__Guild__manorBoon__15A53433]  DEFAULT ((0)),
	[manorBoonItemCount6] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorBoon__1699586C]  DEFAULT ((0)),
	[manorBoonFund] [bigint] NOT NULL CONSTRAINT [DF__Guild__manorBoon__178D7CA5]  DEFAULT ((0)),
	[manorTrain] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorTrai__1881A0DE]  DEFAULT ((0)),
	[manorTrainStudySwitch] [smallint] NOT NULL CONSTRAINT [DF__Guild__manorTrai__1975C517]  DEFAULT ((0)),
	[manorDelate] [tinyint] NOT NULL CONSTRAINT [DF__Guild__manorDela__1A69E950]  DEFAULT ((0)),
	[manorRemoveBuildingDate] [datetime] NULL,
	[manorMasterOfflineDate] [datetime] NULL,
	[manorRoomDrugProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorRoom__1B5E0D89]  DEFAULT ((0)),
	[manorRoomCookProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorRoom__1C5231C2]  DEFAULT ((0)),
	[manorRoomWineProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorRoom__1D4655FB]  DEFAULT ((0)),
	[manorRoomHPProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorRoom__1E3A7A34]  DEFAULT ((0)),
	[manorRoomSPProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorRoom__1F2E9E6D]  DEFAULT ((0)),
	[manorRoomHuntingProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorRoom__2022C2A6]  DEFAULT ((0)),
	[manorRoomMineProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorRoom__2116E6DF]  DEFAULT ((0)),
	[manorRoomGatherProcess] [int] NOT NULL CONSTRAINT [DF__Guild__manorRoom__220B0B18]  DEFAULT ((0)),
	[guildPvPCWMorale] [int] NOT NULL CONSTRAINT [DF__Guild__guildPvPC__22FF2F51]  DEFAULT ((0)),
	[guildPvPCWTeams] [nvarchar](300) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Guild__guildPvPC__23F3538A]  DEFAULT (N''),
	[groupPvPVSGuildId] [bigint] NOT NULL CONSTRAINT [DF__Guild__groupPvPV__24E777C3]  DEFAULT ((0)),
	[guildPvPCWTentCount] [int] NOT NULL CONSTRAINT [DF__Guild__guildPvPC__25DB9BFC]  DEFAULT ((0)),
	[guildPvPCWBannerCount] [int] NOT NULL CONSTRAINT [DF__Guild__guildPvPC__26CFC035]  DEFAULT ((0)),
	[guildPvPCWSide] [int] NOT NULL CONSTRAINT [DF__Guild__guildPvPC__27C3E46E]  DEFAULT ((0)),
	[guildPvPCWTimeTotal] [int] NOT NULL CONSTRAINT [DF__Guild__guildPvPC__28B808A7]  DEFAULT ((0)),
	[PvPCWKilled] [int] NOT NULL CONSTRAINT [DF__Guild__PvPCWKill__29AC2CE0]  DEFAULT ((0)),
	[ArtifactType] [int] NOT NULL CONSTRAINT [DF__Guild__ArtifactT__2AA05119]  DEFAULT ((0)),
 CONSTRAINT [PK_Guild] PRIMARY KEY CLUSTERED 
(
	[guild_uid] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_Guild] ON [dbo].[Guild] 
(
	[name] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[Skill]    脚本日期: 12/02/2011 11:56:07 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Skill](
	[skill_id] [int] NOT NULL,
	[owner_id] [bigint] NOT NULL,
	[owner_type] [smallint] NOT NULL,
	[skill_lv] [int] NOT NULL CONSTRAINT [DF__Skill__skill_lv__5224328E]  DEFAULT ((0)),
	[cool_down] [bigint] NOT NULL CONSTRAINT [DF__Skill__cool_down__531856C7]  DEFAULT ((0)),
	[skill_hide] [smallint] NOT NULL CONSTRAINT [DF__Skill__skill_hid__540C7B00]  DEFAULT ((0)),
 CONSTRAINT [PK_Skill] PRIMARY KEY CLUSTERED 
(
	[skill_id] ASC,
	[owner_id] ASC,
	[owner_type] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_Skill] ON [dbo].[Skill] 
(
	[owner_id] ASC,
	[owner_type] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[Generation]    脚本日期: 12/02/2011 11:56:07 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Generation](
	[YoungerId] [bigint] NOT NULL,
	[ElderId] [bigint] NOT NULL,
	[DevoteAccmulation] [int] NULL CONSTRAINT [DF__Generatio__Devot__52793849]  DEFAULT ((0)),
	[GiftPoint] [int] NULL CONSTRAINT [DF__Generatio__GiftP__536D5C82]  DEFAULT ((3)),
	[RecvExp] [int] NULL CONSTRAINT [DF__Generatio__RecvE__546180BB]  DEFAULT ((0)),
	[YoungerName] [nchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL,
	[ElderName] [nchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_Generation] ON [dbo].[Generation] 
(
	[ElderId] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[BussinessGuild]    脚本日期: 12/02/2011 11:56:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[BussinessGuild](
	[BussinessGuildName] [nchar](15) COLLATE Chinese_PRC_CI_AS NOT NULL,
	[ProductType] [int] NOT NULL,
	[OwnerName] [nchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL,
	[OwnerId] [bigint] NOT NULL,
	[BaseCash] [bigint] NOT NULL,
	[BussinessCash] [bigint] NOT NULL,
	[BussinessGuildId] [bigint] NOT NULL,
	[CreateDate] [datetime] NULL CONSTRAINT [DF__Bussiness__Creat__573DED66]  DEFAULT (getdate()),
	[GuildDescription] [nchar](145) COLLATE Chinese_PRC_CI_AS NULL CONSTRAINT [DF__Bussiness__Guild__5832119F]  DEFAULT (''),
	[PlateNum] [int] NULL CONSTRAINT [DF__Bussiness__Plate__592635D8]  DEFAULT ((1)),
	[BussinessPartnerID1] [bigint] NULL CONSTRAINT [DF__Bussiness__Bussi__5A1A5A11]  DEFAULT ((0)),
	[BussinessPartnerID2] [bigint] NULL CONSTRAINT [DF__Bussiness__Bussi__5B0E7E4A]  DEFAULT ((0)),
	[BussinessPartnerID3] [bigint] NULL CONSTRAINT [DF__Bussiness__Bussi__5C02A283]  DEFAULT ((0)),
	[State] [int] NULL CONSTRAINT [DF__Bussiness__State__5CF6C6BC]  DEFAULT ((0)),
	[SellPrice] [bigint] NULL CONSTRAINT [DF__Bussiness__SellP__5DEAEAF5]  DEFAULT ((0)),
	[SellEndDate] [datetime] NULL CONSTRAINT [DF__Bussiness__SellE__5EDF0F2E]  DEFAULT ((0)),
	[LockPassword] [nchar](25) COLLATE Chinese_PRC_CI_AS NULL CONSTRAINT [DF__Bussiness__LockP__5FD33367]  DEFAULT (''),
	[OpenPlateNum] [int] NULL CONSTRAINT [DF__Bussiness__OpenP__60C757A0]  DEFAULT ((0)),
	[LockState] [int] NULL CONSTRAINT [DF__Bussiness__LockS__61BB7BD9]  DEFAULT ((2147483647)),
	[ForceUnlockDate] [datetime] NULL CONSTRAINT [DF__Bussiness__Force__62AFA012]  DEFAULT ((0)),
 CONSTRAINT [PK_BussinessGuild] PRIMARY KEY CLUSTERED 
(
	[BussinessGuildId] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[QuestType]    脚本日期: 12/02/2011 11:56:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[QuestType](
	[char_id] [bigint] NOT NULL,
	[type_id] [int] NOT NULL,
	[Name] [nchar](32) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__QuestType__Name__57DD0BE4]  DEFAULT (N''),
	[Round] [int] NOT NULL CONSTRAINT [DF__QuestType__Round__58D1301D]  DEFAULT ((0)),
	[MaxRound] [int] NOT NULL CONSTRAINT [DF__QuestType__MaxRo__59C55456]  DEFAULT ((0)),
	[TotalRound] [int] NOT NULL CONSTRAINT [DF__QuestType__Total__5AB9788F]  DEFAULT ((0)),
	[LimitRound] [int] NOT NULL CONSTRAINT [DF__QuestType__Limit__5BAD9CC8]  DEFAULT ((0)),
	[LimitType] [smallint] NOT NULL CONSTRAINT [DF__QuestType__Limit__5CA1C101]  DEFAULT ((0)),
	[LastClearTime] [datetime] NULL,
 CONSTRAINT [PK_QuestType] PRIMARY KEY CLUSTERED 
(
	[char_id] ASC,
	[type_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_QuestType] ON [dbo].[QuestType] 
(
	[char_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[Partner]    脚本日期: 12/02/2011 11:56:12 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Partner](
	[partner_id] [bigint] IDENTITY(1,1) NOT NULL,
	[mob_id] [bigint] NOT NULL,
	[owner_id] [bigint] NOT NULL,
	[raname] [nchar](10) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Partner__raname__5F7E2DAC]  DEFAULT (N''),
	[level] [int] NOT NULL CONSTRAINT [DF__Partner__level__607251E5]  DEFAULT ((0)),
	[exp] [bigint] NOT NULL CONSTRAINT [DF__Partner__exp__6166761E]  DEFAULT ((0)),
	[STA] [int] NOT NULL CONSTRAINT [DF__Partner__STA__625A9A57]  DEFAULT ((0)),
	[SPR] [int] NOT NULL CONSTRAINT [DF__Partner__SPR__634EBE90]  DEFAULT ((0)),
	[STR] [int] NOT NULL CONSTRAINT [DF__Partner__STR__6442E2C9]  DEFAULT ((0)),
	[CON] [int] NOT NULL CONSTRAINT [DF__Partner__CON__65370702]  DEFAULT ((0)),
	[AGI] [int] NOT NULL CONSTRAINT [DF__Partner__AGI__662B2B3B]  DEFAULT ((0)),
	[attrPoint] [int] NOT NULL CONSTRAINT [DF__Partner__attrPoi__671F4F74]  DEFAULT ((0)),
	[HP_native] [int] NOT NULL CONSTRAINT [DF__Partner__HP_nati__681373AD]  DEFAULT ((0)),
	[SP_native] [int] NOT NULL CONSTRAINT [DF__Partner__SP_nati__690797E6]  DEFAULT ((0)),
	[ATK_native] [int] NOT NULL CONSTRAINT [DF__Partner__ATK_nat__69FBBC1F]  DEFAULT ((0)),
	[DEF_native] [int] NOT NULL CONSTRAINT [DF__Partner__DEF_nat__6AEFE058]  DEFAULT ((0)),
	[SPD_native] [int] NOT NULL CONSTRAINT [DF__Partner__SPD_nat__6BE40491]  DEFAULT ((0)),
	[POW_native] [int] NOT NULL CONSTRAINT [DF__Partner__POW_nat__6CD828CA]  DEFAULT ((0)),
	[HIT_native] [int] NOT NULL CONSTRAINT [DF__Partner__HIT_nat__6DCC4D03]  DEFAULT ((0)),
	[EVA_native] [int] NOT NULL CONSTRAINT [DF__Partner__EVA_nat__6EC0713C]  DEFAULT ((0)),
	[grow] [real] NOT NULL CONSTRAINT [DF__Partner__grow__6FB49575]  DEFAULT ((0.0)),
	[HP] [int] NOT NULL CONSTRAINT [DF__Partner__HP__70A8B9AE]  DEFAULT ((0)),
	[mHP] [int] NOT NULL CONSTRAINT [DF__Partner__mHP__719CDDE7]  DEFAULT ((0)),
	[maxHP] [int] NOT NULL CONSTRAINT [DF__Partner__maxHP__72910220]  DEFAULT ((0)),
	[SP] [int] NOT NULL CONSTRAINT [DF__Partner__SP__73852659]  DEFAULT ((0)),
	[mSP] [int] NOT NULL CONSTRAINT [DF__Partner__mSP__74794A92]  DEFAULT ((0)),
	[maxSP] [int] NOT NULL CONSTRAINT [DF__Partner__maxSP__756D6ECB]  DEFAULT ((0)),
	[favour] [real] NOT NULL CONSTRAINT [DF__Partner__favour__76619304]  DEFAULT ((0.0)),
	[state] [smallint] NOT NULL CONSTRAINT [DF__Partner__state__7755B73D]  DEFAULT ((0)),
	[buff] [nvarchar](800) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Partner__buff__7849DB76]  DEFAULT (N''),
	[health] [int] NOT NULL CONSTRAINT [DF__Partner__health__793DFFAF]  DEFAULT ((0)),
	[goodness] [int] NOT NULL CONSTRAINT [DF__Partner__goodnes__7A3223E8]  DEFAULT ((0)),
	[soulboundState] [smallint] NOT NULL CONSTRAINT [DF__Partner__soulbou__7B264821]  DEFAULT ((0)),
	[expireDate] [datetime] NULL,
	[element] [smallint] NOT NULL CONSTRAINT [DF__Partner__element__7C1A6C5A]  DEFAULT ((0)),
	[outLookColor] [int] NOT NULL CONSTRAINT [DF__Partner__outLook__7D0E9093]  DEFAULT ((0)),
	[inWareHouse] [tinyint] NOT NULL CONSTRAINT [DF__Partner__inWareH__7E02B4CC]  DEFAULT ((0)),
	[lock] [tinyint] NOT NULL CONSTRAINT [DF__Partner__lock__7EF6D905]  DEFAULT ((0)),
	[cultivation] [int] NOT NULL CONSTRAINT [DF__Partner__cultiva__7FEAFD3E]  DEFAULT ((0)),
	[practice] [int] NOT NULL CONSTRAINT [DF__Partner__practic__00DF2177]  DEFAULT ((0)),
 CONSTRAINT [PK_Partner] PRIMARY KEY CLUSTERED 
(
	[partner_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_Partner] ON [dbo].[Partner] 
(
	[owner_id] ASC,
	[inWareHouse] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[BussinessItemInfo]    脚本日期: 12/02/2011 11:56:13 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[BussinessItemInfo](
	[BussinessGuildID] [bigint] NOT NULL,
	[PlateNum] [smallint] NOT NULL,
	[PositionOfPlate] [smallint] NOT NULL,
	[ItemUid] [bigint] NOT NULL,
	[ItemType] [smallint] NOT NULL,
	[ItemState] [smallint] NULL CONSTRAINT [DF__Bussiness__ItemS__658C0CBD]  DEFAULT ((0)),
	[Price] [bigint] NOT NULL CONSTRAINT [DF__Bussiness__Price__668030F6]  DEFAULT ((0)),
 CONSTRAINT [PK_BussinessItemInfo] PRIMARY KEY CLUSTERED 
(
	[ItemUid] ASC,
	[ItemType] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[BussinessLog]    脚本日期: 12/02/2011 11:56:13 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[BussinessLog](
	[BussinessGuildId] [bigint] NOT NULL,
	[LogType] [smallint] NOT NULL,
	[RecordDate] [datetime] NULL CONSTRAINT [DF__Bussiness__Recor__68687968]  DEFAULT (getdate()),
	[RecordMessage] [nchar](129) COLLATE Chinese_PRC_CI_AS NOT NULL
) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[InactiveCharacter]    脚本日期: 12/02/2011 11:56:13 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[InactiveCharacter](
	[acct_id] [bigint] NOT NULL,
	[char_id] [bigint] NOT NULL,
	[nickName] [nchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__InactiveC__nickN__6B44E613]  DEFAULT (N''),
 CONSTRAINT [PK_InactiveCharacter] PRIMARY KEY CLUSTERED 
(
	[char_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_InactiveCharacter1] ON [dbo].[InactiveCharacter] 
(
	[acct_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_InactiveCharacter2] ON [dbo].[InactiveCharacter] 
(
	[char_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_InactiveCharacter3] ON [dbo].[InactiveCharacter] 
(
	[nickName] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[Title]    脚本日期: 12/02/2011 11:56:13 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Title](
	[title_uid] [bigint] IDENTITY(1,1) NOT NULL,
	[owner_id] [bigint] NOT NULL,
	[title_id] [int] NOT NULL,
	[expireDate] [datetime] NULL,
 CONSTRAINT [PK_Title] PRIMARY KEY CLUSTERED 
(
	[title_uid] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_Title] ON [dbo].[Title] 
(
	[owner_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[Pet]    脚本日期: 12/02/2011 11:56:15 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Pet](
	[pet_uid] [bigint] IDENTITY(1,1) NOT NULL,
	[pet_id] [bigint] NOT NULL CONSTRAINT [DF__Pet__pet_id__70099B30]  DEFAULT ((0)),
	[owner_id] [bigint] NOT NULL CONSTRAINT [DF__Pet__owner_id__70FDBF69]  DEFAULT ((0)),
	[name] [nchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Pet__name__71F1E3A2]  DEFAULT (N''),
	[sex] [smallint] NOT NULL CONSTRAINT [DF__Pet__sex__72E607DB]  DEFAULT ((0)),
	[level] [int] NOT NULL CONSTRAINT [DF__Pet__level__73DA2C14]  DEFAULT ((0)),
	[exp] [bigint] NOT NULL CONSTRAINT [DF__Pet__exp__74CE504D]  DEFAULT ((0)),
	[state] [smallint] NOT NULL CONSTRAINT [DF__Pet__state__75C27486]  DEFAULT ((0)),
	[birthCount] [smallint] NOT NULL CONSTRAINT [DF__Pet__birthCount__76B698BF]  DEFAULT ((0)),
	[firstMaster] [nvarchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Pet__firstMaster__77AABCF8]  DEFAULT (N''),
	[father_id] [bigint] NOT NULL CONSTRAINT [DF__Pet__father_id__789EE131]  DEFAULT ((0)),
	[father_name] [nvarchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Pet__father_name__7993056A]  DEFAULT (N''),
	[mother_id] [bigint] NOT NULL CONSTRAINT [DF__Pet__mother_id__7A8729A3]  DEFAULT ((0)),
	[mother_name] [nvarchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__Pet__mother_name__7B7B4DDC]  DEFAULT (N''),
	[happiness] [smallint] NOT NULL CONSTRAINT [DF__Pet__happiness__7C6F7215]  DEFAULT ((0)),
	[VP] [int] NOT NULL CONSTRAINT [DF__Pet__VP__7D63964E]  DEFAULT ((0)),
	[maxVP] [int] NOT NULL CONSTRAINT [DF__Pet__maxVP__7E57BA87]  DEFAULT ((0)),
	[element] [smallint] NOT NULL CONSTRAINT [DF__Pet__element__7F4BDEC0]  DEFAULT ((0)),
	[expireDate] [datetime] NULL,
	[soulbound] [smallint] NOT NULL CONSTRAINT [DF__Pet__soulbound__004002F9]  DEFAULT ((0)),
	[color] [int] NOT NULL CONSTRAINT [DF__Pet__color__01342732]  DEFAULT ((0)),
	[spirit] [int] NOT NULL CONSTRAINT [DF__Pet__spirit__02284B6B]  DEFAULT ((0)),
	[depute_master] [bigint] NOT NULL CONSTRAINT [DF__Pet__depute_mast__031C6FA4]  DEFAULT ((0)),
	[depute_time] [int] NOT NULL CONSTRAINT [DF__Pet__depute_time__041093DD]  DEFAULT ((0)),
	[depute_useTime] [int] NOT NULL CONSTRAINT [DF__Pet__depute_useT__0504B816]  DEFAULT ((0)),
	[depute_exp] [bigint] NOT NULL CONSTRAINT [DF__Pet__depute_exp__05F8DC4F]  DEFAULT ((0)),
	[inWareHouse] [tinyint] NOT NULL CONSTRAINT [DF__Pet__inWareHouse__06ED0088]  DEFAULT ((0)),
	[lock] [tinyint] NOT NULL CONSTRAINT [DF__Pet__lock__07E124C1]  DEFAULT ((0)),
	[VPUseTime] [bigint] NOT NULL CONSTRAINT [DF__Pet__VPUseTime__08D548FA]  DEFAULT ((0)),
 CONSTRAINT [PK_Pet] PRIMARY KEY CLUSTERED 
(
	[pet_uid] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_Pet] ON [dbo].[Pet] 
(
	[owner_id] ASC,
	[inWareHouse] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[Messenger]    脚本日期: 12/02/2011 11:56:16 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[Messenger](
	[player_char_id] [bigint] NOT NULL CONSTRAINT [DF__Messenger__playe__73BA3083]  DEFAULT ((0)),
	[friend_char_id] [bigint] NOT NULL CONSTRAINT [DF__Messenger__frien__74AE54BC]  DEFAULT ((0)),
	[friend_relation] [smallint] NOT NULL CONSTRAINT [DF__Messenger__frien__75A278F5]  DEFAULT ((0)),
	[friend_group] [smallint] NOT NULL CONSTRAINT [DF__Messenger__frien__76969D2E]  DEFAULT ((0)),
	[friend_friendly] [int] NOT NULL CONSTRAINT [DF__Messenger__frien__778AC167]  DEFAULT ((0)),
 CONSTRAINT [PK_Messenger] PRIMARY KEY CLUSTERED 
(
	[player_char_id] ASC,
	[friend_char_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_Messenger1] ON [dbo].[Messenger] 
(
	[player_char_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_Messenger2] ON [dbo].[Messenger] 
(
	[friend_char_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[ElementDesc]    脚本日期: 12/02/2011 11:56:18 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ElementDesc](
	[CharId] [bigint] NOT NULL,
	[WindAttack] [int] NULL CONSTRAINT [DF__ElementDe__WindA__7A672E12]  DEFAULT ((0)),
	[EarthAttack] [int] NULL CONSTRAINT [DF__ElementDe__Earth__7B5B524B]  DEFAULT ((0)),
	[WaterAttack] [int] NULL CONSTRAINT [DF__ElementDe__Water__7C4F7684]  DEFAULT ((0)),
	[FireAttack] [int] NULL CONSTRAINT [DF__ElementDe__FireA__7D439ABD]  DEFAULT ((0)),
	[WindAnti] [int] NULL CONSTRAINT [DF__ElementDe__WindA__7E37BEF6]  DEFAULT ((0)),
	[EarthAnti] [int] NULL CONSTRAINT [DF__ElementDe__Earth__7F2BE32F]  DEFAULT ((0)),
	[WaterAnti] [int] NULL CONSTRAINT [DF__ElementDe__Water__00200768]  DEFAULT ((0)),
	[FireAnti] [int] NULL CONSTRAINT [DF__ElementDe__FireA__01142BA1]  DEFAULT ((0)),
	[WindIngr] [int] NULL CONSTRAINT [DF__ElementDe__WindI__02084FDA]  DEFAULT ((0)),
	[EarthIngr] [int] NULL CONSTRAINT [DF__ElementDe__Earth__02FC7413]  DEFAULT ((0)),
	[WaterIngr] [int] NULL CONSTRAINT [DF__ElementDe__Water__03F0984C]  DEFAULT ((0)),
	[FireIngr] [int] NULL CONSTRAINT [DF__ElementDe__FireI__04E4BC85]  DEFAULT ((0)),
	[WindDecrDownLimit] [int] NULL CONSTRAINT [DF__ElementDe__WindD__05D8E0BE]  DEFAULT ((0)),
	[EarthDecrDownLimit] [int] NULL CONSTRAINT [DF__ElementDe__Earth__06CD04F7]  DEFAULT ((0)),
	[WaterDecrDownLimit] [int] NULL CONSTRAINT [DF__ElementDe__Water__07C12930]  DEFAULT ((0)),
	[FireDecrDownLimit] [int] NULL CONSTRAINT [DF__ElementDe__FireD__08B54D69]  DEFAULT ((0)),
	[PoJunGrade] [int] NULL CONSTRAINT [DF__ElementDe__PoJun__09A971A2]  DEFAULT ((0)),
	[KaiYangGrade] [int] NULL CONSTRAINT [DF__ElementDe__KaiYa__0A9D95DB]  DEFAULT ((0)),
	[PoJunCata1] [bigint] NULL CONSTRAINT [DF__ElementDe__PoJun__0B91BA14]  DEFAULT ((0)),
	[PoJunCata2] [bigint] NULL CONSTRAINT [DF__ElementDe__PoJun__0C85DE4D]  DEFAULT ((0)),
	[PoJunCata3] [bigint] NULL CONSTRAINT [DF__ElementDe__PoJun__0D7A0286]  DEFAULT ((0)),
	[PoJunCata4] [bigint] NULL CONSTRAINT [DF__ElementDe__PoJun__0E6E26BF]  DEFAULT ((0)),
	[KaiYangCata1] [bigint] NULL CONSTRAINT [DF__ElementDe__KaiYa__0F624AF8]  DEFAULT ((0)),
	[KaiYangCata2] [bigint] NULL CONSTRAINT [DF__ElementDe__KaiYa__10566F31]  DEFAULT ((0)),
	[KaiYangCata3] [bigint] NULL CONSTRAINT [DF__ElementDe__KaiYa__114A936A]  DEFAULT ((0)),
	[KaiYangCata4] [bigint] NULL CONSTRAINT [DF__ElementDe__KaiYa__123EB7A3]  DEFAULT ((0)),
 CONSTRAINT [PK_ElementDesc] PRIMARY KEY CLUSTERED 
(
	[CharId] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[ElementSkill]    脚本日期: 12/02/2011 11:56:18 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[ElementSkill](
	[CharId] [bigint] NOT NULL,
	[BelongCataId] [bigint] NOT NULL,
	[ElementSkillId] [bigint] NOT NULL,
	[ElementSkillLevel] [int] NULL CONSTRAINT [DF__ElementSk__Eleme__03BB8E22]  DEFAULT ((1)),
	[CurrentCost] [int] NOT NULL,
	[CostDownLimit] [int] NOT NULL,
 CONSTRAINT [PK_ElementSkill] PRIMARY KEY CLUSTERED 
(
	[CharId] ASC,
	[ElementSkillId] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[WeaponsPoint]    脚本日期: 12/02/2011 11:56:19 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[WeaponsPoint](
	[weaponsPoint_uid] [int] NOT NULL CONSTRAINT [DF__WeaponsPo__weapo__0697FACD]  DEFAULT ((0)),
	[char_id] [bigint] NOT NULL CONSTRAINT [DF__WeaponsPo__char___078C1F06]  DEFAULT ((0)),
	[nickName] [nchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__WeaponsPo__nickN__0880433F]  DEFAULT (N''),
	[sex] [smallint] NOT NULL CONSTRAINT [DF__WeaponsPoin__sex__09746778]  DEFAULT ((0)),
	[cclass] [smallint] NOT NULL CONSTRAINT [DF__WeaponsPo__cclas__0A688BB1]  DEFAULT ((0)),
	[sexClass] [smallint] NOT NULL CONSTRAINT [DF__WeaponsPo__sexCl__0B5CAFEA]  DEFAULT ((0)),
	[faction] [smallint] NOT NULL CONSTRAINT [DF__WeaponsPo__facti__0C50D423]  DEFAULT ((0)),
	[level] [int] NOT NULL CONSTRAINT [DF__WeaponsPo__level__0D44F85C]  DEFAULT ((0)),
	[points] [int] NOT NULL CONSTRAINT [DF__WeaponsPo__point__0E391C95]  DEFAULT ((0)),
	[level_Type] [smallint] NOT NULL CONSTRAINT [DF__WeaponsPo__level__0F2D40CE]  DEFAULT ((0)),
	[guild_uid] [bigint] NOT NULL CONSTRAINT [DF__WeaponsPo__guild__10216507]  DEFAULT ((0)),
	[updateTime] [datetime] NULL,
 CONSTRAINT [PK_WeaponsPoint] PRIMARY KEY CLUSTERED 
(
	[weaponsPoint_uid] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_WeaponsPoint] ON [dbo].[WeaponsPoint] 
(
	[char_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  View [dbo].[MsgCharView]    脚本日期: 12/02/2011 11:56:22 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE VIEW [dbo].[MsgCharView] AS
SELECT char_id, nickName, sex, cclass, faction, [level], title, photo_id,
hairStyle1, hairStyle2, hairColor, eq_weapon, eq_weaponColor, eq_headBand,
eq_headColor, eq_clothColor, eq_cloth, org_hairStyle1, org_hairColor,
org_eq_cloth, org_eq_clothColor, friend_status, friend_icon, friend_about,
friend_onlineAutoReply, friend_offlineAutoReply, speakBlock, speakCount,
offlineTime, guild_uid, money,HistoryGenAccmulation
FROM Character
WHERE (void = 0)
GO
/****** 对象:  View [dbo].[CharacterView]    脚本日期: 12/02/2011 11:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE VIEW [dbo].[CharacterView] AS
SELECT acct_id, char_id, nickName, sex, cclass, faction, [level], exp, STA,
SPR, STR, CON, AGI, attrPoint, HP, mHP, maxHP, SP, mSP, maxSP, DP, mDP, maxDP,
WC, maxWC, WcExp, Energy, maxEnergy, VP, maxVP, goodness, honor, title, manor, fDonate,
totalFDonate, mDonate, totalMDonate, money, bankMoney, partner, pet,
maxPartner, maxPet, map_id, map_x, map_y, map_ownerId, reborn_map, reborn_x,
reborn_y, photo_id, hairStyle1, hairStyle2, hairColor, eq_weapon,
eq_weaponColor, eq_headBand, eq_headColor, eq_cloth, eq_clothColor, state,
buff, shortcut0, shortcut1, shortcut2, shortcut3, shortcut4, shortcut5,
shortcut6, shortcut7, shortcut8, shortcut9, PK_Value, org_hairStyle1,
org_hairColor, org_eq_cloth, org_eq_clothColor, shortcuttype0, shortcuttype1,
shortcuttype2, shortcuttype3, shortcuttype4, shortcuttype5, shortcuttype6,
shortcuttype7, shortcuttype8, shortcuttype9, speakCount, offlineTime, TP,
speakBlock, hawkerTime, SMoney, availBackPack, availItemWareHouse,
availPartnerWareHouse, availPetWareHouse, PvPScoreSingle, deleteExpiryDate,
bankLock, siblingId, mark, wantedReward, guild_uid,HistoryGenAccmulation, CurGenAccmulation, 
SingleWarScoreTotal, SingleWarScoreTemp, SingleWarScore, SingleWarGroup, weaponPoints
FROM Character
WHERE (void = 0)
GO
/****** 对象:  StoredProcedure [dbo].[sp_GetColNames]    脚本日期: 12/02/2011 12:01:11 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_GetColNames]
	@dbName sysname, @tblName sysname, @colnames nvarchar(3000) OUTPUT
AS

DECLARE @colcur CURSOR, @colname sysname, @sql nvarchar(100)

IF OBJECT_ID('_syscol', 'SN') IS NOT NULL 
	DROP SYNONYM _syscol

SET @sql = N'CREATE SYNONYM _syscol for ' + @dbName + N'..syscolumns'
EXEC sp_executesql @sql

SET @colcur = CURSOR SCROLL DYNAMIC
	FOR SELECT name from _syscol where id = object_id(@dbName + N'..' + @tblName)

SET @colnames = N''
OPEN @colcur

FETCH NEXT FROM @colcur INTO @colname
WHILE @@FETCH_STATUS = 0
BEGIN
	IF @colnames = N''
		SET @colnames = @colname
	ELSE
		SET @colnames = @colnames + N', ' + @colname
    FETCH NEXT FROM @colcur INTO @colname
END

/* PRINT STR(LEN(@colnames)) + ' ' + @colnames */

CLOSE @colcur;
DEALLOCATE @colcur;
DROP SYNONYM _syscol
GO
/****** 对象:  StoredProcedure [dbo].[sp_InactiveAccount]    脚本日期: 12/02/2011 11:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[sp_InactiveAccount]
	@AccountDb sysname, @GameDb sysname, 
	@AccountDb_Arc sysname, @GameDb_Arc sysname,
	@active_days int
AS

PRINT '========================== START INACTIVE ACCOUNT ======================'

BEGIN TRAN
BEGIN

BEGIN TRY

DECLARE @sql nvarchar(4000), @colnames nvarchar(3000)

/* use game db for all stored procedure and temp view */
SET @sql = N'USE ' + @GameDb
EXEC sp_executesql @sql

/* create archive account and character views */
IF OBJECT_ID('Account_Arc', 'V') IS NOT NULL 
	DROP VIEW Account_Arc

SET @sql =
N'CREATE VIEW Account_Arc AS
	SELECT acct_id FROM ' + @AccountDb + N'..Account
	WHERE disconnect_time is NOT NULL AND 
	DateDiff(hh, disconnect_time, GetDate()) > 24*' + STR(@active_days, 3)
EXEC sp_executesql @sql

IF OBJECT_ID('Character_Arc', 'V') IS NOT NULL 
	DROP VIEW Character_Arc

SET @sql =
N'CREATE VIEW Character_Arc AS
	SELECT char_id FROM ' + @GameDb + N'..Character
	WHERE void = 0 AND acct_id IN (SELECT acct_id FROM Account_Arc)'
EXEC sp_executesql @sql

/* find inactive account and move to archive db */
EXEC sp_GetColNames @AccountDb, 'Account', @colnames OUTPUT
SET @sql =
N'INSERT INTO ' + @AccountDb + N'..InactiveAccount
	SELECT acct_id, loginName, password_hash, banTime
	FROM ' + @AccountDb + N'..Account WITH (UPDLOCK)
	WHERE acct_id IN (SELECT acct_id FROM Account_Arc)'
EXEC sp_executesql @sql

/* archive account */
PRINT 'archive account ...'
SET @sql = 
N'SET IDENTITY_INSERT ' + @AccountDb_Arc + N'..Account ON
INSERT INTO ' + @AccountDb_Arc + N'..Account (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @AccountDb + N'..Account WITH (UPDLOCK)
	WHERE acct_id IN (SELECT acct_id FROM Account_Arc)
SET IDENTITY_INSERT ' + @AccountDb_Arc + N'..Account OFF'
EXEC sp_executesql @sql

/* archive gift box */
PRINT 'archive gift box ...'
EXEC sp_GetColNames @AccountDb, 'GiftBox', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @AccountDb_Arc + N'..GiftBox ON
INSERT INTO ' + @AccountDb_Arc + N'..GiftBox (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @AccountDb + N'..GiftBox WITH (UPDLOCK)
	WHERE acct_id IN (SELECT acct_id FROM Account_Arc)
SET IDENTITY_INSERT ' + @AccountDb_Arc + N'..GiftBox OFF
DELETE FROM ' + @AccountDb + N'..GiftBox
	WHERE acct_id IN (SELECT acct_id FROM Account_Arc)'
EXEC sp_executesql @sql

/* store inactive character by inactive account */
EXEC sp_GetColNames @GameDb, 'Character', @colnames OUTPUT
SET @sql =
N'INSERT INTO ' + @GameDb + N'..InactiveCharacter
	SELECT acct_id, char_id, nickName
	FROM ' + @GameDb + N'..Character WITH (UPDLOCK)
	WHERE char_id IN (SELECT char_id FROM Character_Arc)'
EXEC sp_executesql @sql

/* archive character */
PRINT 'archive character ...'
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb_Arc + N'..Character ON
INSERT INTO ' + @GameDb_Arc + N'..Character (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb + N'..Character WITH (UPDLOCK)
	WHERE char_id IN (SELECT char_id FROM Character_Arc)
SET IDENTITY_INSERT ' + @GameDb_Arc + N'..Character OFF'
EXEC sp_executesql @sql

/* archive item */
PRINT 'archive item ...'
EXEC sp_GetColNames @GameDb, 'Item', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb_Arc + N'..Item ON
INSERT INTO ' + @GameDb_Arc + N'..Item (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb + N'..Item WITH (UPDLOCK)
	WHERE owner_id IN (SELECT char_id FROM Character_Arc)
SET IDENTITY_INSERT ' + @GameDb_Arc + N'..Item OFF
DELETE FROM ' + @GameDb + N'..Item
	WHERE owner_id IN (SELECT char_id FROM Character_Arc)'
EXEC sp_executesql @sql

/* archive character skill */
PRINT 'archive character skill ...'
EXEC sp_GetColNames @GameDb, 'Skill', @colnames OUTPUT
SET @sql = 
N'INSERT INTO ' + @GameDb_Arc + N'..Skill (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb + N'..Skill WITH (UPDLOCK)
	WHERE owner_type = 0 AND owner_id IN (SELECT char_id FROM Character_Arc)
DELETE FROM ' + @GameDb + N'..Skill
	WHERE owner_type = 0 AND owner_id IN (SELECT char_id FROM Character_Arc)'
EXEC sp_executesql @sql

/* archive partner skill */
PRINT 'archive partner skill ...'
SET @sql = 
N'INSERT INTO ' + @GameDb_Arc + N'..Skill (' + @colnames + N')
SELECT ' + @colnames + N' FROM ' + @GameDb + N'..Skill WITH (UPDLOCK)
	WHERE owner_type = 1 AND owner_id IN
	(SELECT p.partner_id FROM ' + @GameDb + N'..Partner AS p, 
	Character_Arc AS d WHERE p.owner_id = d.char_id)
DELETE FROM ' + @GameDb + N'..Skill
	WHERE owner_type = 1 AND owner_id IN
	(SELECT p.partner_id FROM ' + @GameDb + N'..Partner AS p, 
	Character_Arc AS d WHERE p.owner_id = d.char_id)'
EXEC sp_executesql @sql

/* archive pet skill */
PRINT 'archive pet skill ...'
SET @sql = 
N'INSERT INTO ' + @GameDb_Arc + N'..Skill (' + @colnames + N')
SELECT ' + @colnames + N' FROM ' + @GameDb + N'..Skill WITH (UPDLOCK)
	WHERE owner_type = 2 AND owner_id IN
	(SELECT p.pet_uid FROM ' + @GameDb + N'..Pet AS p, 
	Character_Arc AS d WHERE p.owner_id = d.char_id)
DELETE FROM ' + @GameDb + N'..Skill
	WHERE owner_type = 2 AND owner_id IN
	(SELECT p.pet_uid FROM ' + @GameDb + N'..Pet AS p, 
	Character_Arc AS d WHERE p.owner_id = d.char_id)'
EXEC sp_executesql @sql

/* archive partner */
PRINT 'archive partner ...'
EXEC sp_GetColNames @GameDb, 'Partner', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb_Arc + N'..Partner ON
INSERT INTO ' + @GameDb_Arc + N'..Partner (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb + N'..Partner WITH (UPDLOCK)
	WHERE owner_id IN (SELECT char_id FROM Character_Arc)
SET IDENTITY_INSERT ' + @GameDb_Arc + N'..Partner OFF
DELETE FROM ' + @GameDb + N'..Partner
	WHERE owner_id IN (SELECT char_id FROM Character_Arc)'
EXEC sp_executesql @sql

/* archive pet */
PRINT 'archive pet ...'
EXEC sp_GetColNames @GameDb, 'Pet', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb_Arc + N'..Pet ON
INSERT INTO ' + @GameDb_Arc + N'..Pet (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb + N'..Pet WITH (UPDLOCK)
	WHERE owner_id IN (SELECT char_id FROM Character_Arc)
SET IDENTITY_INSERT ' + @GameDb_Arc + N'..Pet OFF
DELETE FROM ' + @GameDb + N'..Pet
	WHERE owner_id IN (SELECT char_id FROM Character_Arc)'
EXEC sp_executesql @sql

/* archive quest log */
PRINT 'archive quest log ...'
EXEC sp_GetColNames @GameDb, 'QuestLog', @colnames OUTPUT
SET @sql = 
N'INSERT INTO ' + @GameDb_Arc + N'..QuestLog (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb + N'..QuestLog WITH (UPDLOCK)
	WHERE char_id IN (SELECT char_id FROM Character_Arc)
DELETE FROM ' + @GameDb + N'..QuestLog
	WHERE char_id IN (SELECT char_id FROM Character_Arc)'
EXEC sp_executesql @sql

/* archive quest type */
PRINT 'archive quest type ...'
EXEC sp_GetColNames @GameDb, 'QuestType', @colnames OUTPUT
SET @sql = 
N'INSERT INTO ' + @GameDb_Arc + N'..QuestType (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb + N'..QuestType WITH (UPDLOCK)
	WHERE char_id IN (SELECT char_id FROM Character_Arc)
DELETE FROM ' + @GameDb + N'..QuestType
	WHERE char_id IN (SELECT char_id FROM Character_Arc)'
EXEC sp_executesql @sql

/* archive quest flag */
PRINT 'archive quest flag ...'
EXEC sp_GetColNames @GameDb, 'QuestFlag', @colnames OUTPUT
SET @sql = 
N'INSERT INTO ' + @GameDb_Arc + N'..QuestFlag (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb + N'..QuestFlag WITH (UPDLOCK)
	WHERE char_id IN (SELECT char_id FROM Character_Arc)
DELETE FROM ' + @GameDb + N'..QuestFlag
	WHERE char_id IN (SELECT char_id FROM Character_Arc)'
EXEC sp_executesql @sql

/* archive title */
PRINT 'archive title ...'
EXEC sp_GetColNames @GameDb, 'Title', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb_Arc + N'..Title ON
INSERT INTO ' + @GameDb_Arc + N'..Title (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb + N'..Title WITH (UPDLOCK)
	WHERE owner_id IN (SELECT char_id FROM Character_Arc)
SET IDENTITY_INSERT ' + @GameDb_Arc + N'..Title OFF
DELETE FROM ' + @GameDb + N'..Title
	WHERE owner_id IN (SELECT char_id FROM Character_Arc)'
EXEC sp_executesql @sql

/* archive messenger */
PRINT 'archive messenger ...'
EXEC sp_GetColNames @GameDb, 'Messenger', @colnames OUTPUT
SET @sql = 
N'INSERT INTO ' + @GameDb_Arc + N'..Messenger (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb + N'..Messenger WITH (UPDLOCK)
	WHERE player_char_id IN (SELECT char_id FROM Character_Arc)
DELETE FROM ' + @GameDb + N'..Messenger
	WHERE player_char_id IN (SELECT char_id FROM Character_Arc)'
EXEC sp_executesql @sql

/* archive partner collection */
PRINT 'archive partner collection ...'
EXEC sp_GetColNames @GameDb, 'PartnerCollection', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb_Arc + N'..PartnerCollection ON
INSERT INTO ' + @GameDb_Arc + N'..PartnerCollection (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb + N'..PartnerCollection WITH (UPDLOCK)
	WHERE char_id IN (SELECT char_id FROM Character_Arc)
SET IDENTITY_INSERT ' + @GameDb_Arc + N'..PartnerCollection OFF
DELETE FROM ' + @GameDb + N'..PartnerCollection
	WHERE char_id IN (SELECT char_id FROM Character_Arc)'
EXEC sp_executesql @sql

/* archive HawkerHistory */
PRINT 'archive hawker history ...'
EXEC sp_GetColNames @GameDb, 'HawkerHistory', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb_Arc + N'..HawkerHistory ON
INSERT INTO ' + @GameDb_Arc + N'..HawkerHistory (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb + N'..HawkerHistory WITH (UPDLOCK)
	WHERE char_id IN (SELECT char_id FROM Character_Arc)
SET IDENTITY_INSERT ' + @GameDb_Arc + N'..HawkerHistory OFF
DELETE FROM ' + @GameDb + N'..HawkerHistory
	WHERE char_id IN (SELECT char_id FROM Character_Arc)'
EXEC sp_executesql @sql

/* archive sell yuan bao */
PRINT 'archive sell yuan bao ...'
EXEC sp_GetColNames @GameDb, 'SellYuanBao', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb_Arc + N'..SellYuanBao ON
INSERT INTO ' + @GameDb_Arc + N'..SellYuanBao (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb + N'..SellYuanBao WITH (UPDLOCK)
	WHERE char_id IN (SELECT char_id FROM Character_Arc)
SET IDENTITY_INSERT ' + @GameDb_Arc + N'..SellYuanBao OFF
DELETE FROM ' + @GameDb + N'..SellYuanBao
	WHERE char_id IN (SELECT char_id FROM Character_Arc)'
EXEC sp_executesql @sql

/* delete archive characters and accounts at last */
SET @sql = 
N'DELETE FROM ' + @GameDb + N'..Character
	WHERE char_id IN (SELECT char_id FROM Character_Arc)'
EXEC sp_executesql @sql

SET @sql = 
N'DELETE FROM ' + @AccountDb + N'..Account
	WHERE acct_id IN (SELECT acct_id FROM Account_Arc)'
EXEC sp_executesql @sql

/* finally clear temp view */
DROP VIEW Character_Arc
DROP VIEW Account_Arc

COMMIT TRAN

END TRY
BEGIN CATCH
	ROLLBACK TRAN
	SELECT ERROR_NUMBER() as ErrorNumber, ERROR_MESSAGE() as ErrorMessage

    DECLARE @errMsg nvarchar(4000), @errSeverity int, @errState int
	SELECT @errMsg = ERROR_MESSAGE(), @errSeverity = ERROR_SEVERITY(), 
		@errState = ERROR_STATE()
	RAISERROR(@errMsg, @errSeverity, @errState)
END CATCH
END	/* end transaction */

PRINT '========================== END INACTIVE ACCOUNT ======================'

RETURN
GO
/****** 对象:  StoredProcedure [dbo].[sp_ReactiveAccount]    脚本日期: 12/02/2011 11:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[sp_ReactiveAccount]
	@AccountDb sysname, @GameDb sysname, 
	@AccountDb_Arc sysname, @GameDb_Arc sysname,
	@acct_name nvarchar(16) 
AS

PRINT '======================== START REACTIVATE ACCOUNT ========================='

SET @acct_name = UPPER(LTRIM(RTRIM(@acct_name)))

BEGIN TRAN

BEGIN
BEGIN TRY

DECLARE @sql nvarchar(4000), @colnames nvarchar(3000)
DECLARE @acct_id bigint, @count int, @acct_str nvarchar(20)

/* use game db for all stored procedure and temp view*/
SET @sql = N'USE ' + @GameDb
EXEC sp_executesql @sql

/* check inactive account exist */
SET @sql =
N'SELECT @aid = acct_id, @cnt = count(*) FROM ' + @AccountDb + 
	N'..InactiveAccount WHERE loginName = ' + 
	QUOTENAME(@acct_name, '''') + N' GROUP BY acct_id'
EXEC sp_executesql @sql, N'@aid bigint output, @cnt int output', 
	@aid = @acct_id output, @cnt = @count output

/* just return if inactive account not found */
IF @count > 0
BEGIN

SET @acct_str = LTRIM(STR(@acct_id))

/* move back inactive account to account db */
IF OBJECT_ID('CharacterReact', 'V') IS NOT NULL 
	DROP VIEW CharacterReact

SET @sql =
N'CREATE VIEW CharacterReact AS
	SELECT char_id FROM ' + @GameDb + N'..InactiveCharacter
	WHERE acct_id = ' + @acct_str
EXEC sp_executesql @sql

/* restore account */
PRINT 'restore account ' + QUOTENAME(@acct_name, '''') + 
	N', acct_id = ' + @acct_str + ' ...'
EXEC sp_GetColNames @AccountDb, 'Account', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @AccountDb + N'..Account ON
INSERT INTO ' + @AccountDb + N'..Account (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @AccountDb_Arc + N'..Account WITH (UPDLOCK) 
	WHERE acct_id = ' + @acct_str + N'
SET IDENTITY_INSERT ' + @AccountDb_Arc + N'..Account OFF'
EXEC sp_executesql @sql

/* restore gift box */
PRINT 'restore gift box ...'
EXEC sp_GetColNames @AccountDb, 'GiftBox', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @AccountDb + N'..GiftBox ON
INSERT INTO ' + @AccountDb + N'..GiftBox (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @AccountDb_Arc + N'..GiftBox WITH (UPDLOCK)
	WHERE acct_id = ' + @acct_str + N'
SET IDENTITY_INSERT ' + @AccountDb_Arc + N'..GiftBox OFF
DELETE FROM ' + @AccountDb_Arc + N'..GiftBox
	WHERE acct_id = ' + @acct_str
EXEC sp_executesql @sql

/* move back all inactive characters to game db */

/* restore character */
PRINT 'restore character ...'
EXEC sp_GetColNames @GameDb, 'Character', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..Character ON
INSERT INTO ' + @GameDb + N'..Character (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Character WITH (UPDLOCK)
	WHERE acct_id = ' + @acct_str + N'
SET IDENTITY_INSERT ' + @GameDb_Arc + N'..Character OFF'
EXEC sp_executesql @sql

/* restore item */
PRINT 'restore item ...'
EXEC sp_GetColNames @GameDb, 'Item', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..Item ON
INSERT INTO ' + @GameDb + N'..Item (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Item WITH (UPDLOCK)
	WHERE owner_id IN (SELECT char_id FROM CharacterReact)
SET IDENTITY_INSERT ' + @GameDb + N'..Item OFF
DELETE FROM ' + @GameDb_Arc + N'..Item
	WHERE owner_id IN (SELECT char_id FROM CharacterReact)'
EXEC sp_executesql @sql

/* restore character skill */
PRINT 'archive character skill ...'
EXEC sp_GetColNames @GameDb, 'Skill', @colnames OUTPUT
SET @sql = 
N'INSERT INTO ' + @GameDb + N'..Skill (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Skill WITH (UPDLOCK)
	WHERE owner_type = 0 AND owner_id IN (SELECT char_id FROM CharacterReact)
DELETE FROM ' + @GameDb_Arc + N'..Skill
	WHERE owner_type = 0 AND owner_id IN (SELECT char_id FROM CharacterReact)'
EXEC sp_executesql @sql

/* restore partner skill */
PRINT 'archive partner skill ...'
SET @sql = 
N'INSERT INTO ' + @GameDb + N'..Skill (' + @colnames + N')
SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Skill WITH (UPDLOCK)
	WHERE owner_type = 1 AND owner_id IN
	(SELECT p.partner_id FROM ' + @GameDb_Arc + N'..Partner AS p, 
	CharacterReact AS d WHERE p.owner_id = d.char_id)
DELETE FROM ' + @GameDb_Arc + N'..Skill
	WHERE owner_type = 1 AND owner_id IN
	(SELECT p.partner_id FROM ' + @GameDb_Arc + N'..Partner AS p, 
	CharacterReact AS d WHERE p.owner_id = d.char_id)'
EXEC sp_executesql @sql

/* restore pet skill */
PRINT 'archive pet skill ...'
SET @sql = 
N'INSERT INTO ' + @GameDb + N'..Skill (' + @colnames + N')
SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Skill WITH (UPDLOCK)
	WHERE owner_type = 2 AND owner_id IN
	(SELECT p.pet_uid FROM ' + @GameDb_Arc + N'..Pet AS p, 
	CharacterReact AS d WHERE p.owner_id = d.char_id)
DELETE FROM ' + @GameDb_Arc + N'..Skill
	WHERE owner_type = 2 AND owner_id IN
	(SELECT p.pet_uid FROM ' + @GameDb_Arc + N'..Pet AS p, 
	CharacterReact AS d WHERE p.owner_id = d.char_id)'
EXEC sp_executesql @sql

/* restore partner */
PRINT 'restore partner ...'
EXEC sp_GetColNames @GameDb, 'Partner', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..Partner ON
INSERT INTO ' + @GameDb + N'..Partner (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Partner WITH (UPDLOCK)
	WHERE owner_id IN (SELECT char_id FROM CharacterReact)
SET IDENTITY_INSERT ' + @GameDb + N'..Partner OFF
DELETE FROM ' + @GameDb_Arc + N'..Partner
	WHERE owner_id IN (SELECT char_id FROM CharacterReact)'
EXEC sp_executesql @sql

/* restore pet */
PRINT 'restore pet ...'
EXEC sp_GetColNames @GameDb, 'Pet', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..Pet ON
INSERT INTO ' + @GameDb + N'..Pet (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Pet WITH (UPDLOCK)
	WHERE owner_id IN (SELECT char_id FROM CharacterReact)
SET IDENTITY_INSERT ' + @GameDb + N'..Pet OFF
DELETE FROM ' + @GameDb_Arc + N'..Pet
	WHERE owner_id IN (SELECT char_id FROM CharacterReact)'
EXEC sp_executesql @sql

/* restore quest log */
PRINT 'restore quest log ...'
EXEC sp_GetColNames @GameDb, 'QuestLog', @colnames OUTPUT
SET @sql = 
N'INSERT INTO ' + @GameDb + N'..QuestLog (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..QuestLog WITH (UPDLOCK)
	WHERE char_id IN (SELECT char_id FROM CharacterReact)
DELETE FROM ' + @GameDb_Arc + N'..QuestLog
	WHERE char_id IN (SELECT char_id FROM CharacterReact)'
EXEC sp_executesql @sql

/* restore quest type */
PRINT 'restore quest type ...'
EXEC sp_GetColNames @GameDb, 'QuestType', @colnames OUTPUT
SET @sql = 
N'INSERT INTO ' + @GameDb + N'..QuestType (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..QuestType WITH (UPDLOCK)
	WHERE char_id IN (SELECT char_id FROM CharacterReact)
DELETE FROM ' + @GameDb_Arc + N'..QuestType
	WHERE char_id IN (SELECT char_id FROM CharacterReact)'
EXEC sp_executesql @sql

/* restore quest flag */
PRINT 'restore quest flag ...'
EXEC sp_GetColNames @GameDb, 'QuestFlag', @colnames OUTPUT
SET @sql = 
N'INSERT INTO ' + @GameDb + N'..QuestFlag (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..QuestFlag WITH (UPDLOCK)
	WHERE char_id IN (SELECT char_id FROM CharacterReact)
DELETE FROM ' + @GameDb_Arc + N'..QuestFlag
	WHERE char_id IN (SELECT char_id FROM CharacterReact)'
EXEC sp_executesql @sql

/* restore title */
PRINT 'restore title ...'
EXEC sp_GetColNames @GameDb, 'Title', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..Title ON
INSERT INTO ' + @GameDb + N'..Title (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Title WITH (UPDLOCK)
	WHERE owner_id IN (SELECT char_id FROM CharacterReact)
SET IDENTITY_INSERT ' + @GameDb + N'..Title OFF
DELETE FROM ' + @GameDb_Arc + N'..Title
	WHERE owner_id IN (SELECT char_id FROM CharacterReact)'
EXEC sp_executesql @sql

/* restore messenger */
PRINT 'restore messenger ...'
EXEC sp_GetColNames @GameDb, 'Messenger', @colnames OUTPUT
SET @sql = 
N'INSERT INTO ' + @GameDb + N'..Messenger (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Messenger WITH (UPDLOCK)
	WHERE player_char_id IN (SELECT char_id FROM CharacterReact)
DELETE FROM ' + @GameDb_Arc + N'..Messenger
	WHERE player_char_id IN (SELECT char_id FROM CharacterReact)'
EXEC sp_executesql @sql

/* restore partner collection */
PRINT 'restore partner collection ...'
EXEC sp_GetColNames @GameDb, 'PartnerCollection', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..PartnerCollection ON
INSERT INTO ' + @GameDb + N'..PartnerCollection (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..PartnerCollection WITH (UPDLOCK)
	WHERE char_id IN (SELECT char_id FROM CharacterReact)
SET IDENTITY_INSERT ' + @GameDb + N'..PartnerCollection OFF
DELETE FROM ' + @GameDb_Arc + N'..PartnerCollection
	WHERE char_id IN (SELECT char_id FROM CharacterReact)'
EXEC sp_executesql @sql

/* restore hawker history */
PRINT 'restore hawker history ...'
EXEC sp_GetColNames @GameDb, 'HawkerHistory', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..HawkerHistory ON
INSERT INTO ' + @GameDb + N'..HawkerHistory (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..HawkerHistory WITH (UPDLOCK)
	WHERE char_id IN (SELECT char_id FROM CharacterReact)
SET IDENTITY_INSERT ' + @GameDb + N'..HawkerHistory OFF
DELETE FROM ' + @GameDb_Arc + N'..HawkerHistory
	WHERE char_id IN (SELECT char_id FROM CharacterReact)'
EXEC sp_executesql @sql

/* restore sell yuan bao */
PRINT 'restore sell yuan bao ...'
EXEC sp_GetColNames @GameDb, 'SellYuanBao', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..SellYuanBao ON
INSERT INTO ' + @GameDb + N'..SellYuanBao (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..SellYuanBao WITH (UPDLOCK)
	WHERE char_id IN (SELECT char_id FROM CharacterReact)
SET IDENTITY_INSERT ' + @GameDb + N'..SellYuanBao OFF
DELETE FROM ' + @GameDb_Arc + N'..SellYuanBao
	WHERE char_id IN (SELECT char_id FROM CharacterReact)'
EXEC sp_executesql @sql

/* clear temp view */
DROP VIEW CharacterReact

/* remove inactive character records */
SET @sql = 
N'DELETE FROM ' + @GameDb + N'..InactiveCharacter
	WHERE acct_id = ' + @acct_str + N'
DELETE FROM ' + @GameDb_Arc + N'..Character
	WHERE acct_id = ' + @acct_str
EXEC sp_executesql @sql

/* remove inactive account record */
SET @sql = 
N'DELETE FROM ' + @AccountDb + N'..InactiveAccount
	WHERE acct_id = ' + @acct_str + N'
DELETE FROM ' + @AccountDb_Arc + N'..Account
	WHERE acct_id = ' + @acct_str
EXEC sp_executesql @sql

END
ELSE
	PRINT 'ReactiveAccount Failed: [account not found], account name = ' +
		QUOTENAME(@acct_name, '''')
COMMIT TRAN

END TRY
BEGIN CATCH
	ROLLBACK TRAN
	SELECT ERROR_NUMBER() as ErrorNumber, ERROR_MESSAGE() as ErrorMessage

    DECLARE @errMsg nvarchar(4000), @errSeverity int, @errState int
	SELECT @errMsg = ERROR_MESSAGE(), @errSeverity = ERROR_SEVERITY(), 
		@errState = ERROR_STATE()
	RAISERROR(@errMsg, @errSeverity, @errState)
END CATCH
END	/* end transaction */

PRINT '======================== END REACTIVATE ACCOUNT ========================='

RETURN
GO
/****** 对象:  StoredProcedure [dbo].[sp_RestoreAccount]    脚本日期: 12/02/2011 11:56:31 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[sp_RestoreAccount]
	@AccountDb sysname, @GameDb sysname, 
	@AccountDb_Arc sysname, @GameDb_Arc sysname
AS

PRINT '======================== START RESTORE ACCOUNT ========================='

BEGIN TRAN
BEGIN

BEGIN TRY

DECLARE @sql nvarchar(4000), @colnames nvarchar(3000)

/* use game db for all stored procedure and temp view*/
SET @sql = N'USE ' + @GameDb
EXEC sp_executesql @sql

IF OBJECT_ID('Account_Arc', 'V') IS NOT NULL 
	DROP VIEW Account_Arc

/* move back all inactive accounts to account db */

/* restore account */
PRINT 'restore account ...'
EXEC sp_GetColNames @AccountDb, 'Account', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @AccountDb + N'..Account ON
INSERT INTO ' + @AccountDb + N'..Account (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @AccountDb_Arc + N'..Account WITH (UPDLOCK)
SET IDENTITY_INSERT ' + @AccountDb_Arc + N'..Account OFF
DELETE FROM ' + @AccountDb_Arc + N'..Account'
EXEC sp_executesql @sql

/* restore gift box */
PRINT 'restore gift box ...'
EXEC sp_GetColNames @AccountDb, 'GiftBox', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @AccountDb + N'..GiftBox ON
INSERT INTO ' + @AccountDb + N'..GiftBox (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @AccountDb_Arc + N'..GiftBox WITH (UPDLOCK)
SET IDENTITY_INSERT ' + @AccountDb_Arc + N'..GiftBox OFF
DELETE FROM ' + @AccountDb_Arc + N'..GiftBox'
EXEC sp_executesql @sql

/* move back all inactive characters to game db */

/* restore character */
PRINT 'restore character ...'
EXEC sp_GetColNames @GameDb, 'Character', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..Character ON
INSERT INTO ' + @GameDb + N'..Character (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Character WITH (UPDLOCK)
SET IDENTITY_INSERT ' + @GameDb_Arc + N'..Character OFF
DELETE FROM ' + @GameDb_Arc + N'..Character'
EXEC sp_executesql @sql

/* restore item */
PRINT 'restore item ...'
EXEC sp_GetColNames @GameDb, 'Item', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..Item ON
INSERT INTO ' + @GameDb + N'..Item (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Item WITH (UPDLOCK)
SET IDENTITY_INSERT ' + @GameDb + N'..Item OFF
DELETE FROM ' + @GameDb_Arc + N'..Item'
EXEC sp_executesql @sql

/* restore skill */
PRINT 'restore skill ...'
EXEC sp_GetColNames @GameDb, 'Skill', @colnames OUTPUT
SET @sql = 
N'INSERT INTO ' + @GameDb + N'..Skill (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Skill WITH (UPDLOCK)
DELETE FROM ' + @GameDb_Arc + N'..Skill'
EXEC sp_executesql @sql

/* restore partner */
PRINT 'restore partner ...'
EXEC sp_GetColNames @GameDb, 'Partner', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..Partner ON
INSERT INTO ' + @GameDb + N'..Partner (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Partner WITH (UPDLOCK)
SET IDENTITY_INSERT ' + @GameDb + N'..Partner OFF
DELETE FROM ' + @GameDb_Arc + N'..Partner'
EXEC sp_executesql @sql

/* restore pet */
PRINT 'restore pet ...'
EXEC sp_GetColNames @GameDb, 'Pet', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..Pet ON
INSERT INTO ' + @GameDb + N'..Pet (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Pet WITH (UPDLOCK)
SET IDENTITY_INSERT ' + @GameDb + N'..Pet OFF
DELETE FROM ' + @GameDb_Arc + N'..Pet'
EXEC sp_executesql @sql

/* restore quest log */
PRINT 'restore quest log ...'
EXEC sp_GetColNames @GameDb, 'QuestLog', @colnames OUTPUT
SET @sql = 
N'INSERT INTO ' + @GameDb + N'..QuestLog (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..QuestLog WITH (UPDLOCK)
DELETE FROM ' + @GameDb_Arc + N'..QuestLog'
EXEC sp_executesql @sql

/* restore quest type */
PRINT 'restore quest type ...'
EXEC sp_GetColNames @GameDb, 'QuestType', @colnames OUTPUT
SET @sql = 
N'INSERT INTO ' + @GameDb + N'..QuestType (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..QuestType WITH (UPDLOCK)
DELETE FROM ' + @GameDb_Arc + N'..QuestType'
EXEC sp_executesql @sql

/* restore quest flag */
PRINT 'restore quest flag ...'
EXEC sp_GetColNames @GameDb, 'QuestFlag', @colnames OUTPUT
SET @sql = 
N'INSERT INTO ' + @GameDb + N'..QuestFlag (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..QuestFlag WITH (UPDLOCK)
DELETE FROM ' + @GameDb_Arc + N'..QuestFlag'
EXEC sp_executesql @sql

/* restore title */
PRINT 'restore title ...'
EXEC sp_GetColNames @GameDb, 'Title', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..Title ON
INSERT INTO ' + @GameDb + N'..Title (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Title WITH (UPDLOCK)
SET IDENTITY_INSERT ' + @GameDb + N'..Title OFF
DELETE FROM ' + @GameDb_Arc + N'..Title'
EXEC sp_executesql @sql

/* restore messenger */
PRINT 'restore messenger ...'
EXEC sp_GetColNames @GameDb, 'Messenger', @colnames OUTPUT
SET @sql = 
N'INSERT INTO ' + @GameDb + N'..Messenger (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..Messenger WITH (UPDLOCK)
DELETE FROM ' + @GameDb_Arc + N'..Messenger'
EXEC sp_executesql @sql

/* restore partner collection */
PRINT 'restore partner collection ...'
EXEC sp_GetColNames @GameDb, 'PartnerCollection', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..PartnerCollection ON
INSERT INTO ' + @GameDb + N'..PartnerCollection (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..PartnerCollection WITH (UPDLOCK)
SET IDENTITY_INSERT ' + @GameDb + N'..PartnerCollection OFF
DELETE FROM ' + @GameDb_Arc + N'..PartnerCollection'
EXEC sp_executesql @sql

/* restore hawker history */
PRINT 'restore hawker history ...'
EXEC sp_GetColNames @GameDb, 'HawkerHistory', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..HawkerHistory ON
INSERT INTO ' + @GameDb + N'..HawkerHistory (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..HawkerHistory WITH (UPDLOCK)
SET IDENTITY_INSERT ' + @GameDb + N'..HawkerHistory OFF
DELETE FROM ' + @GameDb_Arc + N'..HawkerHistory'
EXEC sp_executesql @sql

/* restore sell yuan bao */
PRINT 'restore sell yuan bao ...'
EXEC sp_GetColNames @GameDb, 'SellYuanBao', @colnames OUTPUT
SET @sql = 
N'SET IDENTITY_INSERT ' + @GameDb + N'..SellYuanBao ON
INSERT INTO ' + @GameDb + N'..SellYuanBao (' + @colnames + N')
	SELECT ' + @colnames + N' FROM ' + @GameDb_Arc + N'..SellYuanBao WITH (UPDLOCK)
SET IDENTITY_INSERT ' + @GameDb + N'..SellYuanBao OFF
DELETE FROM ' + @GameDb_Arc + N'..SellYuanBao'
EXEC sp_executesql @sql

/* remove inactive character records */
SET @sql = 
N'DELETE FROM ' + @GameDb + N'..InactiveCharacter'
EXEC sp_executesql @sql

/* remove inactive account records */
SET @sql = 
N'DELETE FROM ' + @AccountDb + N'..InactiveAccount'
EXEC sp_executesql @sql

COMMIT TRAN

END TRY
BEGIN CATCH
	ROLLBACK TRAN
	SELECT ERROR_NUMBER() as ErrorNumber, ERROR_MESSAGE() as ErrorMessage

    DECLARE @errMsg nvarchar(4000), @errSeverity int, @errState int
	SELECT @errMsg = ERROR_MESSAGE(), @errSeverity = ERROR_SEVERITY(), 
		@errState = ERROR_STATE()
	RAISERROR(@errMsg, @errSeverity, @errState)
END CATCH
END	/* end transaction */

PRINT '======================== END RESTORE ACCOUNT ========================='

RETURN
GO
/****** 对象:  Table [dbo].[GuildMember]    脚本日期: 12/02/2011 11:56:33 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[GuildMember](
	[char_id] [bigint] NOT NULL,
	[guild_uid] [bigint] NOT NULL,
	[donate] [bigint] NOT NULL CONSTRAINT [DF__GuildMemb__donat__12FDD1B2]  DEFAULT ((0)),
	[totalDonate] [bigint] NOT NULL CONSTRAINT [DF__GuildMemb__total__13F1F5EB]  DEFAULT ((0)),
	[post] [smallint] NOT NULL CONSTRAINT [DF__GuildMembe__post__14E61A24]  DEFAULT ((0)),
	[joinDate] [datetime] NOT NULL,
	[businessCount] [int] NOT NULL CONSTRAINT [DF__GuildMemb__busin__15DA3E5D]  DEFAULT ((0)),
	[businessProfit] [bigint] NOT NULL CONSTRAINT [DF__GuildMemb__busin__16CE6296]  DEFAULT ((0)),
	[delateMaster] [smallint] NOT NULL CONSTRAINT [DF__GuildMemb__delat__17C286CF]  DEFAULT ((0)),
	[WinCount] [int] NOT NULL CONSTRAINT [DF__GuildMemb__WinCo__18B6AB08]  DEFAULT ((0)),
	[BannerCount] [int] NOT NULL CONSTRAINT [DF__GuildMemb__Banne__19AACF41]  DEFAULT ((0)),
	[Killed] [int] NOT NULL CONSTRAINT [DF__GuildMemb__Kille__1A9EF37A]  DEFAULT ((0)),
	[Counter] [int] NOT NULL CONSTRAINT [DF__GuildMemb__Count__1B9317B3]  DEFAULT ((0)),
	[Morale] [int] NOT NULL CONSTRAINT [DF__GuildMemb__Moral__1C873BEC]  DEFAULT ((0)),
	[death] [int] NOT NULL CONSTRAINT [DF__GuildMemb__death__1D7B6025]  DEFAULT ((0)),
	[battleCount] [int] NOT NULL CONSTRAINT [DF__GuildMemb__battl__1E6F845E]  DEFAULT ((0)),
	[ProfferBusiness] [bigint] NOT NULL CONSTRAINT [DF__GuildMemb__Proff__1F63A897]  DEFAULT ((0)),
	[ProfferDevelopment] [bigint] NOT NULL CONSTRAINT [DF__GuildMemb__Proff__2057CCD0]  DEFAULT ((0)),
	[ProfferBuild] [bigint] NOT NULL CONSTRAINT [DF__GuildMemb__Proff__214BF109]  DEFAULT ((0)),
	[ProfferElement] [bigint] NOT NULL CONSTRAINT [DF__GuildMemb__Proff__22401542]  DEFAULT ((0)),
	[ProfferBattle] [bigint] NOT NULL CONSTRAINT [DF__GuildMemb__Proff__2334397B]  DEFAULT ((0)),
 CONSTRAINT [PK_GuildMember] PRIMARY KEY CLUSTERED 
(
	[char_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_GuildMember] ON [dbo].[GuildMember] 
(
	[guild_uid] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  Table [dbo].[HawkerHistory]    脚本日期: 12/02/2011 11:56:33 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE TABLE [dbo].[HawkerHistory](
	[hawkerHistory_id] [bigint] IDENTITY(1,1) NOT NULL,
	[char_id] [bigint] NOT NULL CONSTRAINT [DF__HawkerHis__char___151B244E]  DEFAULT ((0)),
	[itemName] [nvarchar](20) COLLATE Chinese_PRC_CI_AS NOT NULL CONSTRAINT [DF__HawkerHis__itemN__160F4887]  DEFAULT (N''),
	[itemType] [smallint] NOT NULL CONSTRAINT [DF__HawkerHis__itemT__17036CC0]  DEFAULT ((0)),
	[stack] [smallint] NOT NULL CONSTRAINT [DF__HawkerHis__stack__17F790F9]  DEFAULT ((0)),
	[totalPrice] [bigint] NOT NULL CONSTRAINT [DF__HawkerHis__total__18EBB532]  DEFAULT ((0)),
	[tax] [bigint] NOT NULL CONSTRAINT [DF__HawkerHisto__tax__19DFD96B]  DEFAULT ((0)),
	[hawkerDate] [datetime] NOT NULL,
 CONSTRAINT [PK_HawkerHistory] PRIMARY KEY CLUSTERED 
(
	[hawkerHistory_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
CREATE NONCLUSTERED INDEX [IX_HawkerHistory] ON [dbo].[HawkerHistory] 
(
	[char_id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, SORT_IN_TEMPDB = OFF, IGNORE_DUP_KEY = OFF, DROP_EXISTING = OFF, ONLINE = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
GO
/****** 对象:  StoredProcedure [dbo].[sp_GetTempBankMoneyYBT]    脚本日期: 12/02/2011 11:56:33 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_GetTempBankMoneyYBT]
	@char_id bigint
AS

DECLARE  @acct_id bigint, @TempYBT bigint, @TempMoney bigint, @TranName VARCHAR(20) ;
SELECT @TranName = 'GetTBMoneyYBT';

BEGIN TRANSACTION @TranName

SELECT @acct_id = acct_id FROM [Character] WHERE char_id = @char_id

SELECT sellYuanBao_id, moneyPerYBT * soldYBT, totalYBT - soldYBT, expireDate FROM SellYuanBao WHERE char_id = @char_id and (soldYBT > 0 or expireDate < GetDate())

SELECT @TempYBT = SUM(totalYBT - soldYBT) FROM SellYuanBao WHERE char_id = @char_id and (totalYBT = soldYBT or expireDate < GetDate())
DELETE FROM SellYuanBao WHERE char_id = @char_id and (totalYBT = soldYBT or expireDate < GetDate())

UPDATE SellYuanBao SET totalYBT = totalYBT - soldYBT, soldYBT = 0 WHERE char_id = @char_id

if (@TempYBT > 0)
	BEGIN
		UPDATE QGLAccount..Account SET yuanbaoTicket = yuanbaoTicket + @TempYBT WHERE acct_id = @acct_id;
	END

COMMIT TRANSACTION @TranName
GO
/****** 对象:  StoredProcedure [dbo].[sp_InsertSellYuanBao]    脚本日期: 12/02/2011 11:56:33 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_InsertSellYuanBao]
	@acct_id bigint, @char_id bigint, @charName nvarchar(10), @sellType smallint, @totalYBT bigint, @moneyPerYBT bigint, @expireDate datetime
AS

DECLARE  @TempYBT bigint, @TranName VARCHAR(20) ;
SELECT @TranName = 'InsertSellYB';

BEGIN TRANSACTION @TranName

SELECT @TempYBT = yuanbaoTicket FROM QGLAccount..Account WHERE acct_id = @acct_id

IF (@TempYBT >= @totalYBT)
	BEGIN
		
		INSERT INTO SellYuanBao (char_id, charName, sellType, totalYBT, moneyPerYBT, expireDate) OUTPUT INSERTED.* VALUES (@char_id, @charName, @sellType, @totalYBT, @moneyPerYBT, @expireDate);
		
		UPDATE QGLAccount..Account SET yuanbaoTicket = @TempYBT - @totalYBT WHERE acct_id = @acct_id;		
	END
ELSE
	BEGIN
		SELECT 0, @char_id, @charName, @sellType, @totalYBT, @moneyPerYBT, 0, @expireDate;	
	END

COMMIT TRANSACTION @TranName
GO
/****** 对象:  StoredProcedure [dbo].[sp_BuyYuanBaoTicket]    脚本日期: 12/02/2011 11:56:34 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[sp_BuyYuanBaoTicket]
	@buyerAcct_id bigint, @sellYuanBao_id bigint, @amount bigint
AS

DECLARE  @TempYBT bigint, @TempSold bigint, @TranName VARCHAR(20) ;
SELECT @TranName = 'BuyYBT';

BEGIN TRANSACTION @TranName

SELECT @TempYBT = totalYBT, @TempSold = soldYBT FROM SellYuanBao WHERE sellYuanBao_id = @sellYuanBao_id

SELECT @TempSold = @TempSold + @amount

IF (@TempSold <= @TempYBT)
	BEGIN		
		SELECT 1, @TempSold
		UPDATE SellYuanBao SET soldYBT = @TempSold WHERE sellYuanBao_id = @sellYuanBao_id
		UPDATE QGLAccount..Account SET yuanbaoTicket = yuanbaoTicket + @amount WHERE acct_id = @buyerAcct_id;
	END
ELSE
	BEGIN
		SELECT 0, 0
	END

COMMIT TRANSACTION @TranName
GO
/****** 对象:  StoredProcedure [dbo].[sp_Addmoney]    脚本日期: 12/02/2011 11:56:34 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[sp_Addmoney]
AS
BEGIN
SET NOCOUNT ON;
update [QGLGame].[dbo].[Guild] set fund=fund+250000
where guild_uid<32

update [QGLGame].[dbo].[Character] set money=money+250000
where char_id in('170','1249','1100','1236','45')
END
GO
/****** 对象:  StoredProcedure [dbo].[sp_GetGenerationAsElder]    脚本日期: 12/02/2011 11:56:34 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE   PROCEDURE [dbo].[sp_GetGenerationAsElder] 
		@ParamElderId bigint
AS
SELECT YoungerId, ElderId, DevoteAccmulation,GiftPoint
FROM Generation WHERE ElderId = @ParamElderId
GO
/****** 对象:  StoredProcedure [dbo].[sp_GetGenerationAsYounger]    脚本日期: 12/02/2011 11:56:34 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE   PROCEDURE [dbo].[sp_GetGenerationAsYounger] 
		@ParamYoungerId bigint
AS
SELECT YoungerId, ElderId, RecvExp
FROM Generation WHERE YoungerId = @ParamYoungerId
GO
/****** 对象:  StoredProcedure [dbo].[sp_GetSpecialGenarationAsElder]    脚本日期: 12/02/2011 11:56:34 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE   PROCEDURE [dbo].[sp_GetSpecialGenarationAsElder]
		@ParamElderId bigint,
		@ParamYoungerId bigint	
AS
SELECT YoungerId, ElderId, DevoteAccmulation,GiftPoint
FROM Generation WHERE ElderId = @ParamElderId AND YoungerId = @ParamYoungerId
GO
/****** 对象:  StoredProcedure [dbo].[sp_GetSpecialGenarationAsYounger]    脚本日期: 12/02/2011 11:56:34 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE   PROCEDURE [dbo].[sp_GetSpecialGenarationAsYounger]
		@ParamYoungerId bigint,
		@ParamElderId bigint	
AS
SELECT YoungerId, ElderId, RecvExp
FROM Generation WHERE ElderId = @ParamElderId AND YoungerId = @ParamYoungerId
GO
/****** 对象:  StoredProcedure [dbo].[sp_RemoveRelation]    脚本日期: 12/02/2011 11:56:34 ******/
SET ANSI_NULLS OFF
GO
SET QUOTED_IDENTIFIER OFF
GO
CREATE PROCEDURE [dbo].[sp_RemoveRelation]
	@owner_id bigint, @target_id bigint, @relation smallint
AS

DECLARE @NowRelation smallint, @TranName VARCHAR(20);
SELECT @TranName = 'MyTransaction1';

BEGIN TRANSACTION @TranName
SET @NowRelation = 0
SELECT @NowRelation = friend_relation FROM Messenger WHERE player_char_id = @owner_id AND friend_char_id = @target_id ;

IF (@NowRelation >= 0)
	BEGIN
		SELECT @NowRelation, 1 ;
		UPDATE  Messenger SET friend_relation = friend_relation & (~@relation)   WHERE player_char_id = @owner_id AND friend_char_id = @target_id;	
	END
ELSE
	BEGIN
		SELECT @NowRelation, 0 ;
	END
COMMIT TRANSACTION @TranName
GO
